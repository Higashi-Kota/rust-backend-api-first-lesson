# ã‚¿ã‚¹ã‚¯ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½å®Ÿè£…ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã‚¿ã‚¹ã‚¯ã«è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ](#ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ)
3. [å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½](#å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½)
4. [ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
5. [å‹•ä½œç¢ºèªæ‰‹é †](#å‹•ä½œç¢ºèªæ‰‹é †)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …)
7. [ãƒ†ã‚¹ãƒˆæ–¹æ³•](#ãƒ†ã‚¹ãƒˆæ–¹æ³•)
8. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
9. [ä»Šå¾Œã®æ‹¡å¼µäºˆå®š](#ä»Šå¾Œã®æ‹¡å¼µäºˆå®š)

## æ¦‚è¦

### æ©Ÿèƒ½è¦ä»¶

- ã‚¿ã‚¹ã‚¯ã«è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜å¯èƒ½
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€å‰Šé™¤æ©Ÿèƒ½
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã«å¿œã˜ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ã‚©ãƒ¼ã‚¿
- ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- å°†æ¥çš„ãªæ‹¡å¼µ: ç½²åä»˜ãURLã€è‡ªå‹•åœ§ç¸®ã«ã‚ˆã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 
  - é–‹ç™ºç’°å¢ƒ: MinIOï¼ˆS3äº’æ›ï¼‰
  - æœ¬ç•ªç’°å¢ƒ: Cloudflare R2
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Axumã®multipartæ©Ÿèƒ½
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQLï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼‰
- **AWSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: aws-sdk-s3ï¼ˆMinIO/R2ä¸¡å¯¾å¿œï¼‰

## ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«: `task_attachments`

```sql
CREATE TABLE task_attachments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
    uploaded_by UUID NOT NULL REFERENCES users(id),
    file_name VARCHAR(255) NOT NULL,
    file_size BIGINT NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    storage_key VARCHAR(500) NOT NULL UNIQUE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_task_attachments_task_id ON task_attachments(task_id);
CREATE INDEX idx_task_attachments_uploaded_by ON task_attachments(uploaded_by);
```

### 2. APIè¨­è¨ˆ

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| POST | `/tasks/{task_id}/attachments` | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | å¿…è¦ |
| GET | `/tasks/{task_id}/attachments` | ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾— | å¿…è¦ |
| GET | `/attachments/{attachment_id}` | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼çµŒç”±ï¼‰ | å¿…è¦ |
| DELETE | `/attachments/{attachment_id}` | ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ | å¿…è¦ |
| GET | `/attachments/{attachment_id}/download-url` | ç½²åä»˜ããƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLç”Ÿæˆ | å¿…è¦ |
| POST | `/attachments/{attachment_id}/share-links` | å¤–éƒ¨å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆ | å¿…è¦ |
| GET | `/attachments/{attachment_id}/share-links` | å…±æœ‰ãƒªãƒ³ã‚¯ä¸€è¦§å–å¾— | å¿…è¦ |
| DELETE | `/share-links/{share_link_id}` | å…±æœ‰ãƒªãƒ³ã‚¯ç„¡åŠ¹åŒ– | å¿…è¦ |
| GET | `/share/{share_token}` | å…±æœ‰ãƒªãƒ³ã‚¯ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | **ä¸è¦** |

**æ³¨æ„**: ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ `{param}` å½¢å¼ã‚’ä½¿ç”¨ï¼ˆAxum 0.8ã®ä»•æ§˜ï¼‰

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
```bash
POST /tasks/{task_id}/attachments
Content-Type: multipart/form-data

file: (binary)
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "success": true,
  "message": "File uploaded successfully",
  "data": {
    "attachment": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "task_id": "660e8400-e29b-41d4-a716-446655440000",
      "file_name": "è¨­è¨ˆæ›¸.pdf",
      "file_size": 1048576,
      "mime_type": "application/pdf",
      "uploaded_by": "770e8400-e29b-41d4-a716-446655440000",
      "created_at": "2024-01-01T00:00:00Z",
      "updated_at": "2024-01-01T00:00:00Z"
    },
    "message": "File uploaded successfully"
  }
}
```

**ç½²åä»˜ãURLç”Ÿæˆ**
```bash
GET /attachments/{attachment_id}/download-url?expires_in_seconds=3600
Authorization: Bearer <token>
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "success": true,
  "message": "Download URL generated successfully",
  "data": {
    "download_url": "https://storage.example.com/task-attachments/attachments/550e8400-e29b-41d4-a716-446655440000?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...",
    "expires_in_seconds": 3600,
    "expires_at": "2024-01-01T01:00:00Z"
  }
}
```

**å¤–éƒ¨å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆ**
```bash
POST /attachments/{attachment_id}/share-links
Authorization: Bearer <token>
Content-Type: application/json

{
  "description": "Client presentation materials",
  "expires_in_hours": 72,
  "max_access_count": 10
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "success": true,
  "message": "Share link created successfully",
  "data": {
    "share_link": {
      "id": "770e8400-e29b-41d4-a716-446655440000",
      "attachment_id": "550e8400-e29b-41d4-a716-446655440000",
      "description": "Client presentation materials",
      "share_token": "AbCdEfGhIjKlMnOpQrStUvWxYz123456",
      "share_url": "http://localhost:3000/share/AbCdEfGhIjKlMnOpQrStUvWxYz123456",
      "expires_at": "2024-01-04T00:00:00Z",
      "max_access_count": 10,
      "current_access_count": 0,
      "is_revoked": false,
      "created_at": "2024-01-01T00:00:00Z"
    },
    "message": "Share link created successfully"
  }
}
```

**å…±æœ‰ãƒªãƒ³ã‚¯ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆèªè¨¼ä¸è¦ï¼‰**
```bash
GET /share/AbCdEfGhIjKlMnOpQrStUvWxYz123456
# èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ä¸è¦
```

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™

| ãƒ—ãƒ©ãƒ³ | æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | æœ€å¤§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ |
|--------|-------------------|-------------------|
| Free | 5MB | 100MB |
| Pro | 50MB | 10GB |
| Enterprise | 500MB | ç„¡åˆ¶é™ |

### 4. ã‚µãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

#### ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å½¢å¼:
- **ç”»åƒ**: JPEG, PNG, GIF, WebP
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: PDF, Word (.doc, .docx), Excel (.xls, .xlsx), CSV

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### å®Œäº†æ¸ˆã¿ã®å®Ÿè£…

1. âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆtask_attachmentsãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
2. âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆTaskAttachmentï¼‰
3. âœ… ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆS3StorageServiceï¼‰
4. âœ… ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆMinIO/R2ï¼‰
5. âœ… ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAttachmentServiceï¼‰
6. âœ… APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆupload, list, download, delete, generate-urlï¼‰
7. âœ… ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
8. âœ… çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ17ä»¶ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
9. âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æ‹¡å¼µï¼ˆç”»åƒ + PDF/Word/Excel/CSVï¼‰
10. âœ… ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™
11. âœ… ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†
12. âœ… è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
13. âœ… ç½²åä»˜ããƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLç”Ÿæˆï¼ˆPhase 2ï¼‰
14. âœ… å¤–éƒ¨å…±æœ‰ãƒªãƒ³ã‚¯æ©Ÿèƒ½ï¼ˆPhase 2ï¼‰
15. âœ… å…±æœ‰ãƒªãƒ³ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ï¼ˆPhase 2ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´

- **ã‚µãƒ¼ãƒ“ã‚¹å±¤åˆ†é›¢**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ†é›¢
- **ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’AttachmentRepositoryã§æŠ½è±¡åŒ–
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: AppErrorã«ã‚ˆã‚‹çµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†

## ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### Step 1: MinIOã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### Docker Composeã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰

`docker-compose.yml`ã«ä»¥ä¸‹ã‚’è¿½åŠ æ¸ˆã¿:

```yaml
  minio:
    image: minio/minio:latest
    container_name: task-minio
    ports:
      - "9000:9000"     # API endpoint
      - "9001:9001"     # Console endpoint
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    networks:
      - task-network

volumes:
  minio_data:
```

èµ·å‹•æ–¹æ³•:
```bash
# MinIOã‚’å«ã‚€å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
docker-compose up -d

# MinIOã®ã¿èµ·å‹•
docker-compose up -d minio
```

#### Dockerã‚³ãƒãƒ³ãƒ‰ã§å€‹åˆ¥ã«èµ·å‹•ã™ã‚‹å ´åˆ

```bash
# MinIOã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
docker run -d \
  -p 9000:9000 \
  -p 9001:9001 \
  --name task-minio \
  -e MINIO_ROOT_USER=minioadmin \
  -e MINIO_ROOT_PASSWORD=minioadmin \
  minio/minio server /data --console-address ":9001"
```

### Step 2: MinIOã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆmcï¼‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Linuxã®å ´åˆ
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
sudo mv mc /usr/local/bin/

# macOSã®å ´åˆ
brew install minio/stable/mc

# Windowsã®å ´åˆã¯MinIOã®ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

### Step 3: ãƒã‚±ãƒƒãƒˆã®ä½œæˆ

```bash
# MinIOã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¨­å®š
mc alias set local http://localhost:9000 minioadmin minioadmin

# ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
mc mb local/task-attachments

# ãƒã‚±ãƒƒãƒˆã®ä¸€è¦§ã‚’ç¢ºèª
mc ls local/
```

### Step 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```bash
# Storage Configuration (MinIO for development)
STORAGE_ENDPOINT=http://localhost:9000
STORAGE_BUCKET=task-attachments
STORAGE_REGION=us-east-1
STORAGE_ACCESS_KEY=minioadmin
STORAGE_SECRET_KEY=minioadmin
```

**é‡è¦**: ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã¯å¿…é ˆã§ã™ã€‚è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã™ã€‚

## å‹•ä½œç¢ºèªæ‰‹é †

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
make db-migrate

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
make dev
```

æ­£å¸¸èµ·å‹•æ™‚:
```
ğŸ“¦ Initializing storage service...
âœ… Storage service initialized successfully
```

ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯èµ·å‹•ã›ãšã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### 2. MinIOç®¡ç†ç”»é¢ã§ã®ç¢ºèª

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:9001 ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±:
   - Username: `minioadmin`
   - Password: `minioadmin`
3. `task-attachments`ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### 3. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

#### å®Œå…¨ãªãƒ•ãƒ­ãƒ¼: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ â†’ ã‚µã‚¤ãƒ³ã‚¤ãƒ³ â†’ ã‚¿ã‚¹ã‚¯ä½œæˆ â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```bash
# Step 1: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
curl -X POST http://localhost:3000/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "username": "testuser",
    "password": "SecurePass123!"
  }'

# Step 2: ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ï¼‰
TOKEN=$(curl -s -X POST http://localhost:3000/auth/signin \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "test@example.com",
    "password": "SecurePass123!"
  }' | jq -r '.tokens.access_token')

# Step 3: ã‚¿ã‚¹ã‚¯ä½œæˆ
TASK_RESPONSE=$(curl -s -X POST http://localhost:3000/tasks \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "ãƒ†ã‚¹ãƒˆã‚¿ã‚¹ã‚¯",
    "description": "ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆç”¨",
    "status": "todo"
  }')

# ã‚¿ã‚¹ã‚¯IDã‚’å–å¾—
TASK_ID=$(echo $TASK_RESPONSE | jq -r '.id')

# Step 4: ãƒ†ã‚¹ãƒˆç”¨ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
echo -e "\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x01\x00\x00\x00\x01\x08\x02\x00\x00\x00\x90wS\xde" > test-image.png

# Step 5: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
curl -X POST "http://localhost:3000/tasks/$TASK_ID/attachments" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@test-image.png"
```

æˆåŠŸæ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "success": true,
  "message": "File uploaded successfully",
  "data": {
    "attachment": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "task_id": "660e8400-e29b-41d4-a716-446655440000",
      "file_name": "test-image.png",
      "file_size": 1048576,
      "mime_type": "image/png",
      "uploaded_by": "770e8400-e29b-41d4-a716-446655440000",
      "created_at": "2025-01-04T00:00:00Z",
      "updated_at": "2025-01-04T00:00:00Z"
    },
    "message": "File uploaded successfully"
  }
}
```

#### ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—

```bash
curl -X GET "http://localhost:3000/tasks/$TASK_ID/attachments?page=1&per_page=20" \
  -H "Authorization: Bearer $TOKEN"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "success": true,
  "data": {
    "attachments": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "task_id": "660e8400-e29b-41d4-a716-446655440000",
        "uploaded_by": "770e8400-e29b-41d4-a716-446655440000",
        "file_name": "test-image.png",
        "file_size": 1048576,
        "mime_type": "image/png",
        "created_at": "2025-01-04T00:00:00Z",
        "updated_at": "2025-01-04T00:00:00Z"
      }
    ],
    "total": 1
  },
  "message": null
}
```

#### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼çµŒç”±ï¼‰

```bash
# ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—
ATTACHMENT_ID=$(curl -s -X GET "http://localhost:3000/tasks/$TASK_ID/attachments" \
  -H "Authorization: Bearer $TOKEN" \
  | jq -r '.data.attachments[0].id')

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -X GET "http://localhost:3000/attachments/$ATTACHMENT_ID" \
  -H "Authorization: Bearer $TOKEN" \
  -o downloaded-file.png
```

#### ç½²åä»˜ãURLã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰

```bash
# ç½²åä»˜ãURLã‚’å–å¾—
DOWNLOAD_URL=$(curl -s -X GET "http://localhost:3000/attachments/$ATTACHMENT_ID/download-url?expires_in_seconds=3600" \
  -H "Authorization: Bearer $TOKEN" \
  | jq -r '.data.download_url')

# ç½²åä»˜ãURLã§ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆèªè¨¼ä¸è¦ï¼‰
curl -o downloaded-file-direct.png "$DOWNLOAD_URL"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "success": true,
  "message": "Download URL generated successfully",
  "data": {
    "download_url": "http://localhost:9000/task-attachments/attachments/550e8400-e29b-41d4-a716-446655440000?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=...",
    "expires_in_seconds": 3600,
    "expires_at": "2025-01-04T01:00:00Z"
  }
}
```

#### ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

```bash
curl -X DELETE "http://localhost:3000/attachments/$ATTACHMENT_ID" \
  -H "Authorization: Bearer $TOKEN"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "success": true,
  "message": "Attachment deleted successfully",
  "data": null
}
```

#### å…±æœ‰ãƒªãƒ³ã‚¯ã®ä½œæˆã¨ä½¿ç”¨

```bash
# Step 1: æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆå…±æœ‰ç”¨ï¼‰
UPLOAD_RESPONSE=$(curl -s -X POST "http://localhost:3000/tasks/$TASK_ID/attachments" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@test-image.png")

ATTACHMENT_ID=$(echo $UPLOAD_RESPONSE | jq -r '.data.attachment.id')

# Step 2: å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆï¼ˆ72æ™‚é–“æœ‰åŠ¹ã€æœ€å¤§10å›ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
SHARE_RESPONSE=$(curl -s -X POST "http://localhost:3000/attachments/$ATTACHMENT_ID/share-links" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Client presentation",
    "expires_in_hours": 72,
    "max_access_count": 10
  }')

echo "Share Response: $SHARE_RESPONSE"

# å…±æœ‰URLã‚’å–å¾—
SHARE_URL=$(echo $SHARE_RESPONSE | jq -r '.data.share_link.share_url')
echo "Share URL: $SHARE_URL"

# Step 3: å…±æœ‰ãƒªãƒ³ã‚¯ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆèªè¨¼ä¸è¦ï¼‰
curl -o shared-file.png "$SHARE_URL"

# Step 4: å…±æœ‰ãƒªãƒ³ã‚¯ä¸€è¦§ã‚’ç¢ºèª
curl -X GET "http://localhost:3000/attachments/$ATTACHMENT_ID/share-links" \
  -H "Authorization: Bearer $TOKEN"

# Step 5: å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ç„¡åŠ¹åŒ–
SHARE_LINK_ID=$(echo $SHARE_RESPONSE | jq -r '.data.share_link.id')
curl -X DELETE "http://localhost:3000/share-links/$SHARE_LINK_ID" \
  -H "Authorization: Bearer $TOKEN"
```

å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "success": true,
  "message": "Share link created successfully",
  "data": {
    "share_link": {
      "id": "770e8400-e29b-41d4-a716-446655440000",
      "attachment_id": "550e8400-e29b-41d4-a716-446655440000",
      "description": "Client presentation",
      "share_token": "AbCdEfGhIjKlMnOpQrStUvWxYz123456",
      "share_url": "http://localhost:3000/share/AbCdEfGhIjKlMnOpQrStUvWxYz123456",
      "expires_at": "2025-01-07T00:00:00Z",
      "max_access_count": 10,
      "current_access_count": 0,
      "is_revoked": false,
      "created_at": "2025-01-04T00:00:00Z"
    },
    "message": "Share link created successfully"
  }
}
```

### 4. MinIOã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```bash
# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§
mc ls local/task-attachments/attachments/

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°
mc stat local/task-attachments/attachments/<UUID>
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. ç¾åœ¨å®Ÿè£…æ¸ˆã¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **èªè¨¼å¿…é ˆ**: å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§JWTèªè¨¼ãŒå¿…è¦
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤åˆ¥ï¼ˆFree: 5MB, Pro: 50MB, Enterprise: 500MBï¼‰
- **MIMEå‹æ¤œå‡º**: ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã‹ã‚‰MIMEå‹ã‚’æ¨æ¸¬
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¶é™**: ç”»åƒï¼ˆJPEG, PNG, GIF, WebPï¼‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆPDF, Word, Excel, CSVï¼‰ã®ã¿è¨±å¯
- **ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼**: UUIDv4ã§ãƒ•ã‚¡ã‚¤ãƒ«åã®è¡çªã‚’é˜²æ­¢
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: ã‚¿ã‚¹ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æ“ä½œå¯èƒ½
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤åˆ¥ï¼ˆFree: 100MB, Pro: 10GB, Enterprise: ç„¡åˆ¶é™ï¼‰
- **ç½²åä»˜ãURL**: æœŸé™ä»˜ãã®ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLï¼ˆã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ï¼‰

### 2. ä»Šå¾Œå®Ÿè£…äºˆå®šã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

#### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®æ¤œè¨¼å¼·åŒ–ï¼ˆPhase 3ï¼‰

- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ˆã‚‹å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼æ¤œè¨¼ï¼ˆãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒã‚§ãƒƒã‚¯ï¼‰
- æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒã‚¯ãƒ­ã®æ¤œå‡º

## ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1. çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make ci-check-fast

# ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆé–¢é€£ã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
cargo test attachment --features test
```

### 2. å®Ÿè£…æ¸ˆã¿ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆ17ä»¶ï¼‰
- âœ… ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸï¼ˆPNGï¼‰
- âœ… PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… Wordãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.docxï¼‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.xlsxï¼‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æ‹’å¦ï¼ˆ.exeï¼‰
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…éã‚¨ãƒ©ãƒ¼ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤åˆ¥ï¼‰
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ãªã—ã‚¨ãƒ©ãƒ¼
- âœ… ä¸€è¦§å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œï¼‰
- âœ… ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… å‰Šé™¤æˆåŠŸ
- âœ… æ¨©é™ãªã—ã‚¨ãƒ©ãƒ¼
- âœ… å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
- âœ… ç½²åä»˜ãURLç”ŸæˆæˆåŠŸ
- âœ… ç½²åä»˜ãURLãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ‰åŠ¹æœŸé™
- âœ… ç½²åä»˜ãURL - å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«
- âœ… ç½²åä»˜ãURL - æ¨©é™ãªã—ã‚¨ãƒ©ãƒ¼

#### å…±æœ‰ãƒªãƒ³ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰
- âœ… å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆæˆåŠŸ
- âœ… å…±æœ‰ãƒªãƒ³ã‚¯ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
- âœ… å…±æœ‰ãƒªãƒ³ã‚¯ã§ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
- âœ… å…±æœ‰ãƒªãƒ³ã‚¯ä¸€è¦§å–å¾—
- âœ… å…±æœ‰ãƒªãƒ³ã‚¯ç„¡åŠ¹åŒ–
- âœ… ã‚¢ã‚¯ã‚»ã‚¹å›æ•°åˆ¶é™å‹•ä½œ
- âœ… ç„¡åŠ¹ãªå…±æœ‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ©ãƒ¼
- âœ… ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆæ‹’å¦
- âœ… ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…±æœ‰ãƒªãƒ³ã‚¯ç„¡åŠ¹åŒ–æ‹’å¦
- âœ… ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨˜éŒ²

### 3. ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
# ãƒ†ã‚¹ãƒˆç”¨ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
convert -size 100x100 xc:blue test-image.png

# ã¾ãŸã¯ã€ImageMagickãŒãªã„å ´åˆã¯å°ã•ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„
echo "test content" > test-file.txt
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ã‚¨ãƒ©ãƒ¼ã€ŒFailed to load storage configurationã€

**åŸå› **: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat .env | grep STORAGE_

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ã‹ã‚‰å†èµ·å‹•
export STORAGE_ENDPOINT=http://localhost:9000
export STORAGE_BUCKET=task-attachments
export STORAGE_REGION=us-east-1
export STORAGE_ACCESS_KEY=minioadmin
export STORAGE_SECRET_KEY=minioadmin
make dev
```

#### 2. MinIOã¸ã®æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Connection refused`ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:
```bash
# MinIOã‚’Dockerã§èµ·å‹•
docker run -d \
  -p 9000:9000 \
  -p 9001:9001 \
  --name minio \
  -e MINIO_ROOT_USER=minioadmin \
  -e MINIO_ROOT_PASSWORD=minioadmin \
  minio/minio server /data --console-address ":9001"

# ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
mc alias set local http://localhost:9000 minioadmin minioadmin
mc mb local/task-attachments
```

#### 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒ413ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Payload Too Large`ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:
ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€attachment_routes()ã§100MBã¾ã§ã®åˆ¶é™ãŒè¨­å®šæ¸ˆã¿:
```rust
post(upload_attachment_handler)
    .layer(DefaultBodyLimit::max(100 * 1024 * 1024))
```

#### 4. CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—

**è§£æ±ºæ–¹æ³•**:
ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€main.rsã§CORSè¨­å®šæ¸ˆã¿ã€‚å¿…è¦ã«å¿œã˜ã¦èª¿æ•´:
```rust
// middleware/auth.rsã®cors_layer()é–¢æ•°ã‚’ç¢ºèª
```


### ãƒ‡ãƒãƒƒã‚°Tips

1. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ã‚‹**
   ```bash
   RUST_LOG=debug cargo run
   ```

2. **MinIOç®¡ç†ç”»é¢ã§ç¢ºèª**
   - http://localhost:9001 ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å: minioadmin
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: minioadmin

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª**
   ```sql
   SELECT * FROM task_attachments WHERE task_id = 'YOUR_TASK_ID';
   ```

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### Phase 1ï¼ˆå®Œäº†ï¼‰âœ…

1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—æ‹¡å¼µ** âœ…
   - PDFã€Wordã€Excelã€CSVã‚µãƒãƒ¼ãƒˆæ¸ˆã¿
   - MIMEã‚¿ã‚¤ãƒ—ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆå®Ÿè£…æ¸ˆã¿

2. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†** âœ…
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä½ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡è¿½è·¡æ¸ˆã¿
   - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«åŸºã¥ãå®¹é‡åˆ¶é™å®Ÿè£…æ¸ˆã¿

3. **è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** âœ…
   - ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚¨ãƒ©ãƒ¼ã®å…·ä½“çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®Ÿè£…æ¸ˆã¿
   - ã‚¯ã‚©ãƒ¼ã‚¿è¶…éæ™‚ã®è©³ç´°æƒ…å ±è¡¨ç¤ºæ¸ˆã¿

### Phase 2ï¼ˆå®Œäº†ï¼‰âœ…

1. **ç½²åä»˜ãURLæ©Ÿèƒ½** âœ…
   - **ä¸€æ™‚çš„ãªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLç”Ÿæˆ** âœ…
     - S3/R2ã®ç½²åä»˜ãURLï¼ˆPresigned URLï¼‰æ©Ÿèƒ½ã‚’åˆ©ç”¨ âœ…
     - æœ‰åŠ¹æœŸé™è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1æ™‚é–“ã€æœ€å¤§24æ™‚é–“ï¼‰âœ…
     - ç›´æ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸› âœ…
     - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¸¯åŸŸå¹…ã®ç¯€ç´„ âœ…
   
2. **å¤–éƒ¨å…±æœ‰ãƒªãƒ³ã‚¯æ©Ÿèƒ½** âœ…
   - **èªè¨¼ä¸è¦ã®æœŸé™ä»˜ãå…±æœ‰URLç”Ÿæˆ** âœ…
     - ç‹¬è‡ªãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®å…±æœ‰ã‚·ã‚¹ãƒ†ãƒ  âœ…
     - æœ‰åŠ¹æœŸé™è¨­å®šï¼ˆæœ€å°1æ™‚é–“ã€æœ€å¤§30æ—¥ï¼‰âœ…
     - `/share/{token}` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ âœ…
   - **ã‚¢ã‚¯ã‚»ã‚¹å›æ•°åˆ¶é™ã‚ªãƒ—ã‚·ãƒ§ãƒ³** âœ…
     - ä»»æ„ã®æœ€å¤§ã‚¢ã‚¯ã‚»ã‚¹å›æ•°ã‚’è¨­å®šå¯èƒ½ âœ…
     - ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ãƒˆã®è‡ªå‹•è¿½è·¡ âœ…
   - **å…±æœ‰ãƒªãƒ³ã‚¯ã®ç„¡åŠ¹åŒ–æ©Ÿèƒ½** âœ…
     - ä½œæˆè€…ã¾ãŸã¯ã‚¿ã‚¹ã‚¯æ‰€æœ‰è€…ãŒç„¡åŠ¹åŒ–å¯èƒ½ âœ…
     - ç„¡åŠ¹åŒ–å¾Œã¯å³åº§ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ âœ…
   - **ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨˜éŒ²** âœ…
     - IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨User-Agentã‚’è¨˜éŒ² âœ…
     - ã‚¢ã‚¯ã‚»ã‚¹æ™‚åˆ»ã®è¨˜éŒ² âœ…

### Phase 3ï¼ˆå®Œäº†ï¼‰âœ…

1. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–** âœ…
   - **è‡ªå‹•åœ§ç¸®æ©Ÿèƒ½** âœ…
     - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«: WebPå¤‰æ›ã«ã‚ˆã‚‹å®¹é‡å‰Šæ¸›ï¼ˆæœ€å¤§70%å‰Šæ¸›ï¼‰âœ…
       - JPEG/PNG/GIF â†’ WebPè‡ªå‹•å¤‰æ› âœ…
       - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ¥ã®å“è³ªè¨­å®š âœ…
         - Free: 75%å“è³ªã€æœ€å¤§1280x1280px
         - Pro: 85%å“è³ªã€æœ€å¤§2048x2048px
         - Enterprise: 90%å“è³ªã€æœ€å¤§4096x4096pxã€å…ƒãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒ
     - åœ§ç¸®ãƒ¬ãƒ™ãƒ«ã®è¨­å®šï¼ˆå“è³ªå„ªå…ˆ/ã‚µã‚¤ã‚ºå„ªå…ˆï¼‰âœ…
     - å…ƒãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆEnterpriseãƒ—ãƒ©ãƒ³ã®ã¿ï¼‰âœ…
   
   - **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®æœ€é©åŒ–** âœ…
     - ç”»åƒã®ãƒªã‚µã‚¤ã‚ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæœ€å¤§è§£åƒåº¦è¨­å®šï¼‰âœ…
       - ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒã—ãŸè‡ªå‹•ãƒªã‚µã‚¤ã‚º âœ…
     - EXIFãªã©ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è‡ªå‹•é™¤å» âœ…
       - Free/Proãƒ—ãƒ©ãƒ³ã§ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
       - Enterpriseãƒ—ãƒ©ãƒ³ã§ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

### å®Ÿè£…ã‚’è¦‹é€ã‚‹æ©Ÿèƒ½

ä»¥ä¸‹ã®æ©Ÿèƒ½ã¯è¤‡é›‘æ€§ã¨ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€å®Ÿè£…ã‚’è¦‹é€ã‚Šã¾ã™ï¼š

- **ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®å®Ÿè£…ãŒåŠ¹ç‡çš„
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: S3/R2ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ©Ÿèƒ½ã§ä»£æ›¿å¯èƒ½
- **å…¨æ–‡æ¤œç´¢**: ãƒ•ã‚¡ã‚¤ãƒ«åæ¤œç´¢ã§å®Ÿç”¨ä¸Šååˆ†ã€å¿…è¦ã«å¿œã˜ã¦åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å®Ÿè£…
- **ã‚¦ã‚¤ãƒ«ã‚¹ã‚¹ã‚­ãƒ£ãƒ³**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚ç”¨ã®åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å®Ÿè£…ã™ã‚‹æ–¹ãŒæŸ”è»Ÿæ€§ãŒé«˜ã„

## å‚è€ƒæƒ…å ±

### SDKäº’æ›æ€§

- **MinIO**: aws-sdk-s3ã§å®Œå…¨å¯¾å¿œã€`force_path_style(true)`ãŒå¿…è¦
- **Cloudflare R2**: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`auto`ã«è¨­å®šã€ãƒãƒƒãƒå‰Šé™¤ã¯700ä»¶ã¾ã§
- **å…±é€š**: S3 APIã®ä¸»è¦æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã€IAM APIã¯éå¯¾å¿œ

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [MinIOå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://min.io/docs/)
- [Cloudflare R2ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/r2/)
- [AWS SDK for Rust](https://aws.amazon.com/sdk-for-rust/)

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å®Ÿè£…ã®é€²æ—ã«å¿œã˜ã¦éšæ™‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚