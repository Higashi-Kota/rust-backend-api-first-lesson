# ğŸ“‹ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å‘ã‘æ–°è¦ API æ‹¡å¼µè¨ˆç”»

## ğŸ¯ æ¦‚è¦ & å®Ÿè£…é€²æ—

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ã¯ `#[allow(dead_code)]` ã§ãƒãƒ¼ã‚¯ã•ã‚ŒãŸå¤šæ•°ã®å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã‚’ API ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã“ã¨ã§å¤§å¹…ãªæ©Ÿèƒ½æ‹¡å¼µãŒå¯èƒ½ã§ã™ã€‚æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€æ—¢å­˜ API ã¨é‡è¤‡ã—ãªã„**æ–°è¦ä¾¡å€¤æä¾› API**ã‚’ä½“ç³»çš„ã«æ•´ç†ã—ã¾ã™ã€‚

### ğŸ“Š **å®Ÿè£…é€²æ—ã‚µãƒãƒªãƒ¼** (2025-06-25 æ›´æ–°)

- âœ… **Phase 1.1 é«˜åº¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: **100% å®Œäº†** (5/5 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…æ¸ˆã¿)
- âœ… **Phase 1.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†**: **100% å®Œäº†** (7/7 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…æ¸ˆã¿)
- âŒ **Phase 2.1 çµ„ç¹”éšå±¤ç®¡ç†**: **æœªå®Ÿè£…** (0/10 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)
- âœ… **Phase 2.2 ãƒãƒ¼ãƒ æ‹›å¾…ãƒ»æ¨©é™ç®¡ç†**: **100% å®Œäº†** (6/6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…æ¸ˆã¿)

**ç¾åœ¨ã®APIæ•°**: 78 â†’ **96** (+18ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ æ¸ˆã¿)

## ğŸ” ç¾çŠ¶åˆ†æ

### âœ… æ—¢å­˜å®Ÿè£…æ¸ˆã¿ APIï¼ˆ78 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

- åŸºæœ¬èªè¨¼ï¼ˆ11 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆ16 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆ11 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ãƒ­ãƒ¼ãƒ«ãƒ»æ¨©é™ç®¡ç†ï¼ˆ6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆ5 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ãƒãƒ¼ãƒ ãƒ»çµ„ç¹”æ©Ÿèƒ½ï¼ˆ10 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- åˆ†æãƒ»çµ±è¨ˆï¼ˆ3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ï¼ˆ3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

### ğŸš€ æ–°è¦ API æ‹¡å¼µãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«

`#[allow(dead_code)]` é–¢æ•°ã‹ã‚‰**30 å€‹ã®æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã‚’ç™ºè¦‹ï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºåŸºç›¤+çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ï¼‰

---

## ğŸ“Š **æ–°è¦ API æ‹¡å¼µãƒ—ãƒ©ãƒ³**

### ğŸ”§ **Phase 1: ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¼·åŒ–**

_å„ªå…ˆåº¦: ğŸ”¥ æœ€é«˜_

#### **1.1 é«˜åº¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† API** âœ… **100% å®Ÿè£…å®Œäº†**

æ—¢å­˜ã®åŸºæœ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚’å¤§å¹…ã«æ‹¡å¼µï¼š

```http
# æ—¢å­˜: GET /admin/usersï¼ˆåŸºæœ¬æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
# å®Ÿè£…æ¸ˆã¿æ‹¡å¼µ API:
âœ… GET /admin/users/advanced-search      # é«˜åº¦ãªæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
âœ… GET /admin/users/analytics           # ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
âœ… GET /admin/users/by-role/{role}      # ãƒ­ãƒ¼ãƒ«åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
âœ… GET /admin/users/by-subscription     # ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ¥åˆ†æ
âœ… POST /admin/users/bulk-operations    # ä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ

# æœªå®Ÿè£…ï¼ˆå„ªå…ˆåº¦ä½ï¼‰:
âšª GET /admin/users/activity-stats      # ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£çµ±è¨ˆ - åˆ¥é€”æ¤œè¨
```

**å®Ÿè£…çŠ¶æ³**: 
- âœ… Handler: 5/5 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Service: 5/5 å®Œå…¨å®Ÿè£…æ¸ˆã¿  
- âœ… Repository: 5/5 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… DTO: 5/5 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Router: 5/5 ç™»éŒ²æ¸ˆã¿

**ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: ç®¡ç†è€…ã®é‹ç”¨åŠ¹ç‡å‘ä¸Šã€è©³ç´°ãªãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æã€åŠ¹ç‡çš„ãªå¤§é‡ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†


#### **1.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç† API** âœ… **100% å®Ÿè£…å®Œäº†**

_æ–°è¦é ˜åŸŸï¼ˆæ—¢å­˜ API ãªã—ï¼‰_

```http
# å®Ÿè£…æ¸ˆã¿ API:
âœ… GET /admin/security/token-stats        # ãƒˆãƒ¼ã‚¯ãƒ³åˆ©ç”¨çµ±è¨ˆ
âœ… GET /admin/security/refresh-tokens     # ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ç›£è¦–
âœ… POST /admin/security/cleanup-tokens    # æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•å‰Šé™¤
âœ… GET /admin/security/password-resets    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç›£è¦–
âœ… POST /admin/security/revoke-all-tokens # ç·Šæ€¥æ™‚å…¨ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–
âœ… GET /admin/security/session-analytics  # ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†æ
âœ… POST /admin/security/audit-report      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ
```

**å®Ÿè£…çŠ¶æ³**: 
- âœ… Handler: 7/7 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Service: 7/7 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Repository: 7/7 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… DTO: 7/7 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Router: 7/7 ç™»éŒ²æ¸ˆã¿
- âœ… Tests: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆå®Œå‚™

**ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œ

---

### ğŸ¢ **Phase 2: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ»çµ„ç¹”æ©Ÿèƒ½**

_å„ªå…ˆåº¦: ğŸ”¥ é«˜_

#### **2.1 çµ„ç¹”éšå±¤ç®¡ç† API**

æ—¢å­˜ã®åŸºæœ¬çµ„ç¹”æ©Ÿèƒ½ã‚’ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºéšå±¤ç®¡ç†ã«æ‹¡å¼µï¼š

```http
# æ—¢å­˜: åŸºæœ¬çµ„ç¹”CRUDï¼ˆ5ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
# æ–°è¦æ‹¡å¼µ:
GET /organizations/{id}/hierarchy      # çµ„ç¹”éšå±¤æ§‹é€ å–å¾—
POST /organizations/{id}/departments   # éšå±¤å…¥ã‚Œå­éƒ¨é–€ä½œæˆ
GET /organizations/{id}/departments    # éƒ¨é–€ä¸€è¦§ãƒ»éšå±¤è¡¨ç¤º
PUT /organizations/{id}/departments/{dept_id}  # éƒ¨é–€æƒ…å ±ãƒ»éšå±¤æ›´æ–°
DELETE /organizations/{id}/departments/{dept_id}  # éƒ¨é–€å‰Šé™¤ï¼ˆå­éƒ¨é–€ç§»å‹•å‡¦ç†è¾¼ã¿ï¼‰
GET /organizations/{id}/analytics      # çµ„ç¹”åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
PUT /organizations/{id}/permission-matrix      # çµ„ç¹”çµ±ä¸€æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¨­å®š
GET /organizations/{id}/permission-matrix      # çµ„ç¹”æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å–å¾—
GET /organizations/{id}/effective-permissions  # çµ„ç¹”å®ŸåŠ¹æ¨©é™åˆ†æ
POST /organizations/{id}/data-export   # çµ„ç¹”ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆéšå±¤æ§‹é€ ä¿æŒï¼‰
```

**ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: éšå±¤å…¥ã‚Œå­çµ„ç¹”ç®¡ç†ã€çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£

#### **2.2 ãƒãƒ¼ãƒ æ‹›å¾…ãƒ»æ¨©é™ç®¡ç† API** âœ… **100% å®Ÿè£…å®Œäº†**

æ—¢å­˜ãƒãƒ¼ãƒ æ©Ÿèƒ½ã‚’ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ‹›å¾…ãƒ»æ¨©é™ç®¡ç†ã«ç‰¹åŒ–ï¼š

```http
# æ—¢å­˜: åŸºæœ¬ãƒãƒ¼ãƒ ç®¡ç†ï¼ˆ6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
# å®Ÿè£…æ¸ˆã¿æ‹¡å¼µ API:
âœ… POST /teams/{id}/bulk-member-invite    # ä¸€æ‹¬ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…
âœ… GET /teams/{id}/invitations            # æ‹›å¾…çŠ¶æ³ç¢ºèªãƒ»ç®¡ç†
âœ… PUT /teams/{id}/invitations/{invite_id}/decline  # æ‹›å¾…è¾é€€ï¼ˆæ‹›å¾…ã¨ã‚»ãƒƒãƒˆï¼‰
âœ… PUT /teams/{id}/permission-matrix      # ãƒãƒ¼ãƒ è©³ç´°æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¨­å®š
âœ… GET /teams/{id}/permission-matrix      # ãƒãƒ¼ãƒ æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å–å¾—
âœ… GET /teams/{id}/effective-permissions  # ãƒãƒ¼ãƒ å®ŸåŠ¹æ¨©é™åˆ†æ
```

**å®Ÿè£…çŠ¶æ³**:
- âœ… Handler: 6/6 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Service: 6/6 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Repository: 6/6 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… DTO: 6/6 å®Œå…¨å®Ÿè£…æ¸ˆã¿
- âœ… Router: 6/6 ç™»éŒ²æ¸ˆã¿
- âœ… Database: team_invitationsãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ æ¸ˆã¿
- âœ… Tests: å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆå®Œå‚™

**ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**: åŠ¹ç‡çš„ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…ãƒ»è¾é€€ãƒ•ãƒ­ãƒ¼ã€ãƒãƒ¼ãƒ æ¨©é™åˆ¶å¾¡ã€çµ„ç¹”ç¶™æ‰¿æ¨©é™åˆ†æã€å¤‰æ›´å¯¾å¿œ


---

## ğŸ¯ **å®Ÿè£…å„ªå…ˆåº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹**

### **ğŸ”¥ Tier 1 (å®Ÿè£…æ¸ˆã¿ãƒ»é«˜ ROI)**

| API Category         | Implementation Status | Business Impact | Technical Status |
| -------------------- | ------------------- | --------------- | ---------------- |
| é«˜åº¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†     | âœ… **100% å®Œäº†**      | ğŸ”¥ é«˜           | âœ… æœ¬ç•ªæŠ•å…¥å¯èƒ½    |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–     | âœ… **100% å®Œäº†**      | ğŸ”¥ éå¸¸ã«é«˜     | âœ… æœ¬ç•ªæŠ•å…¥å¯èƒ½    |

### **ğŸ”¶ Tier 2 (çŸ­æœŸå®Ÿè£…ãƒ»ä¸­ ROI)**

| API Category               | Implementation Status | Business Impact | Technical Status |
| -------------------------- | -------------------- | --------------- | ---------------- |
| çµ„ç¹”éšå±¤ç®¡ç†               | âŒ æœªå®Ÿè£…             | ğŸ”¶ é«˜           | ğŸ”¶ ä¸­            |
| ãƒãƒ¼ãƒ æ‹›å¾…ãƒ»æ¨©é™ç®¡ç†       | âœ… **100% å®Œäº†**      | ğŸ”¶ ä¸­-é«˜        | âœ… æœ¬ç•ªæŠ•å…¥å¯èƒ½   |

---

## ğŸ—‘ï¸ **å‰Šé™¤æ¨å¥¨ï¼ˆçœŸã®ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰**

### **å‰Šé™¤å¯¾è±¡é–¢æ•°**

ä»¥ä¸‹ã¯å®Ÿè£…ãŒä¸å®Œå…¨ã¾ãŸã¯æ—¢å­˜æ©Ÿèƒ½ã¨é‡è¤‡ã™ã‚‹ãŸã‚å‰Šé™¤æ¨å¥¨ï¼š

```rust
// è¨­å®šã®ã¿ã®æ©Ÿèƒ½ï¼ˆãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ä½ï¼‰
UserRepository::with_schema()
RefreshTokenRepository::with_schema()
PasswordResetTokenRepository::with_schema()

// é‡è¤‡ã™ã‚‹ç°¡å˜ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
EmailService::from_env() // EmailConfig::defaultã§ä»£æ›¿å¯èƒ½
ä¸€éƒ¨ã®email template helper methods // çµ±åˆå¯èƒ½

// æœªå®Œæˆã®å®Ÿè£…
ä¸€éƒ¨ã®configurationæ§‹é€ ä½“ã®field // ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
```

**å‰Šé™¤ã«ã‚ˆã‚‹å½±éŸ¿**: ãªã—ï¼ˆè¨­å®šé–¢æ•°ã‚„ãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ã¿ï¼‰

---

## ğŸ’¡ **æ–°æ©Ÿèƒ½ã«ã‚ˆã‚‹ç«¶äº‰å„ªä½æ€§**

### **1. ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œã®åŒ…æ‹¬æ€§**

- **ç¾åœ¨**: åŸºæœ¬çš„ãªã‚¿ã‚¹ã‚¯ç®¡ç† SaaS
- **å®Ÿè£…å¾Œ**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œã®åŒ…æ‹¬çš„çµ„ç¹”ç®¡ç†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### **2. ç®¡ç†è€…ä½“é¨“ã®é©æ–°**

- **ç¾åœ¨**: é™å®šçš„ãªç®¡ç†æ©Ÿèƒ½
- **å®Ÿè£…å¾Œ**: é«˜åº¦ãªåˆ†æãƒ»ç›£è¦–ãƒ»è‡ªå‹•åŒ–ã‚’å‚™ãˆãŸç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### **3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¼·åŒ–**

- **ç¾åœ¨**: åŸºæœ¬èªè¨¼ãƒ»èªå¯
- **å®Ÿè£…å¾Œ**: åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ãƒ»ç›£æŸ»ã‚·ã‚¹ãƒ†ãƒ 

---

## ğŸ“ˆ **ROI äºˆæ¸¬**

### **å®Ÿè£…ã‚³ã‚¹ãƒˆ vs ä¾¡å€¤**

| Phase   | å®Ÿè£…å·¥æ•° | æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•° | å®Ÿè£…çŠ¶æ³ | ROI äºˆæ¸¬ |
| ------- | -------- | -------------------- | -------- | -------- |
| Phase 1.1 | âœ… **å®Œäº†** | 5 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | âœ… **100%å®Œäº†** | âœ… **å®Ÿç¾æ¸ˆã¿** |
| Phase 1.2 | âœ… **å®Œäº†** | 7 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | âœ… **100%å®Œäº†** | âœ… **å®Ÿç¾æ¸ˆã¿** |
| Phase 2.2 | âœ… **å®Œäº†** | 6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | âœ… **100%å®Œäº†** | âœ… **å®Ÿç¾æ¸ˆã¿** |
| Phase 2.1 | 2-3 é€±é–“ | 10 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ    | âŒ æœªå®Ÿè£… | 200%+    |

### **ç·åˆã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ**

- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•°**: 78 â†’ **96 (ç¾åœ¨)** â†’ 106 (Phase2.1å®Œäº†æ™‚) 
  - âœ… Phase 1.1: +5 (å®Œäº†æ¸ˆã¿)
  - âœ… Phase 1.2: +7 (å®Œäº†æ¸ˆã¿)
  - âœ… Phase 2.2: +6 (å®Œäº†æ¸ˆã¿)
  - âŒ Phase 2.1: +10 (æœªå®Ÿè£…)
- **æ©Ÿèƒ½ã‚«ãƒãƒ¬ãƒƒã‚¸**: åŸºæœ¬ SaaS â†’ **é«˜åº¦ç®¡ç†ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒãƒ¼ãƒ æ‹›å¾…å¼·åŒ–SaaS (ç¾åœ¨)** â†’ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åŸºç›¤ï¼ˆPhase2.1å®Œäº†æ™‚ï¼‰
- **å¸‚å ´ãƒã‚¸ã‚·ãƒ§ãƒ³**: ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ„ãƒ¼ãƒ« â†’ **é«˜æ©Ÿèƒ½ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒãƒ¼ãƒ ç®¡ç†ãƒ„ãƒ¼ãƒ« (ç¾åœ¨)** â†’ æ±ç”¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºåŸºç›¤ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ (Phase2.1å®Œäº†æ™‚)

---

## ğŸ› ï¸ **å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**

### **Phase 1 å®Ÿè£…æ‰‹é †**

**Phase 1.1: âœ… å®Œäº†**
1. âœ… **User Repository functions** ã® `#[allow(dead_code)]` å‰Šé™¤
2. âœ… **å¯¾å¿œã™ã‚‹ Handler** ä½œæˆ
3. âœ… **Router** ã«æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
4. âœ… **API Documentation** æ›´æ–°
5. âœ… **Integration Tests** è¿½åŠ 

**Phase 1.2: âœ… 100% å®Œäº†**
1. âœ… **SecurityService** æ®‹ã‚Š3ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ å®Œäº†
2. âœ… **SecurityHandler** æ®‹ã‚Š3ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ å®Œäº†
3. âœ… **SecurityDTO** å‰Šé™¤æ¸ˆã¿DTOã®å†å®Ÿè£…å®Œäº†
4. âœ… **Router** æ®‹ã‚Š3ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ å®Œäº†
5. âœ… **Integration Tests** è¿½åŠ å®Œäº†

**Phase 2.2: âœ… 100% å®Œäº†**
1. âœ… **Team Invitation Migration** team_invitationsãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ å®Œäº†
2. âœ… **Domain Model** TeamInvitationModelå®Ÿè£…å®Œäº†
3. âœ… **Repository Layer** TeamInvitationRepositoryå®Ÿè£…å®Œäº†
4. âœ… **Service Layer** TeamInvitationServiceå®Ÿè£…å®Œäº†
5. âœ… **API DTOs** ãƒãƒ¼ãƒ æ‹›å¾…DTOå®Ÿè£…å®Œäº†
6. âœ… **Handlers** 6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…å®Œäº†
7. âœ… **Router** ãƒãƒ¼ãƒ æ‹›å¾…ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ å®Œäº†
8. âœ… **Tests** å˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆå®Œå‚™

### **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**

```bash
# æ–°è¦APIã®æ®µéšçš„ãƒ†ã‚¹ãƒˆ
cargo test admin::users::advanced_search
cargo test admin::security::token_management
cargo test organizations::hierarchy
```

### **è¨­å®šç®¡ç†**

æ–°è¦ API ã¯æ—¢å­˜ã®å‹•çš„æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ã¨çµ±åˆã—ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤ã«åŸºã¥ãã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’ç¶™æ‰¿

---

## ğŸ”„ **æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆè¨ˆç”»**

### **âœ… Phase 1.1 å®Œäº†æ¸ˆã¿**

- âœ… é«˜åº¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† API 100% å®Ÿè£…å®Œäº†
- âœ… ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åŸºç›¤å®Œæˆ
- âœ… åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè£…æ¸ˆã¿

### **âœ… Phase 1.2 å®Œäº†æ¸ˆã¿**

- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦– API æ®‹ã‚Š3ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…å®Œäº†
- âœ… å‰Šé™¤æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£DTOã®å†å®Ÿè£…å®Œäº†
- âœ… çµ±åˆãƒ†ã‚¹ãƒˆå®Œæˆ

### **âœ… Phase 2.2 å®Œäº†æ¸ˆã¿**

- âœ… ãƒãƒ¼ãƒ æ‹›å¾…ãƒ»æ¨©é™ç®¡ç† API 6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…å®Œäº†
- âœ… team_invitationsãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- âœ… åŒ…æ‹¬çš„ãªãƒãƒ¼ãƒ æ‹›å¾…ãƒ•ãƒ­ãƒ¼å®Ÿè£…
- âœ… ãƒãƒ¼ãƒ æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ»å®ŸåŠ¹æ¨©é™åˆ†ææ©Ÿèƒ½
- âœ… å˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆå®Œå‚™

### **Phase 2.1: çµ„ç¹”éšå±¤ç®¡ç† (æ¬¡æœŸå®Ÿè£…äºˆå®š)**

- çµ„ç¹”éšå±¤ç®¡ç† API å®Ÿè£…
- éƒ¨é–€ç®¡ç†ãƒ»æ¨©é™ç¶™æ‰¿ã‚·ã‚¹ãƒ†ãƒ 

#### **âš ï¸ Phase 2.1 å®Ÿè£…æ™‚ã®é‡è¦ãªæ³¨æ„äº‹é …ãƒ»å›°é›£ã¨å¯¾ç­–**

**å®Ÿè£…æ¸ˆã¿åŸºç›¤ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆæ—¢å­˜æ´»ç”¨ï¼‰**:
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: 4ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…æ¸ˆã¿ï¼ˆorganization_departments, permission_matrices, organization_analytics, department_membersï¼‰
- âœ… **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«**: å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼ˆ#[allow(dead_code)]ã§ãƒãƒ¼ã‚¯ä¸­ï¼‰
- âœ… **Repositoryå±¤**: å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼ˆ#[allow(dead_code)]ã§ãƒãƒ¼ã‚¯ä¸­ï¼‰
- âš ï¸ **Serviceãƒ»Handlerå±¤**: éƒ¨åˆ†å®Ÿè£…ï¼ˆæœªå®Œæˆï¼‰
- âš ï¸ **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: æœªå®Ÿè£…

**éå»ã®å®Ÿè£…å›°é›£ã¨å¯¾ç­–**:

**ğŸ”´ å›°é›£1: è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ãƒã‚§ãƒ¼ãƒ³**
```
roles â†’ users â†’ organizations â†’ organization_departments â†’ department_members â†’ permission_matrices
                                                          â†“
                                                  organization_analytics
```
**å¯¾ç­–**: 
- æ—¢å­˜ã®`organizations`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åŸºç›¤ã¨ã—ã¦æ´»ç”¨
- æ®µéšçš„å®Ÿè£…ï¼šdepartments â†’ analytics â†’ permissions ã®é †
- æ–°è¦ãƒ¢ãƒ‡ãƒ«ä½œæˆç¦æ­¢ï¼šæ—¢å­˜domain modelã‚’100%æ´»ç”¨

**ğŸ”´ å›°é›£2: ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®æ¥ç¶šãƒ—ãƒ¼ãƒ«æ¯æ¸‡**
```rust
// å•é¡Œã®ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆConnectionAcquire Timeoutç™ºç”Ÿï¼‰
async fn test_department_creation() {
    let role = create_test_role().await;        // DBæ¥ç¶š1
    let user = create_test_user(role).await;    // DBæ¥ç¶š2  
    let org = create_test_org(user).await;      // DBæ¥ç¶š3
    let dept = create_dept(org).await;          // DBæ¥ç¶š4 -> ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
}
```
**å¯¾ç­–**:
- HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã®ãƒ†ã‚¹ãƒˆæ¡ç”¨ï¼ˆPhase 2.2æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- æ—¢å­˜ã®çµ±åˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³æ´»ç”¨
- ç›´æ¥DBæ“ä½œãƒ†ã‚¹ãƒˆã¯æœ€å°é™ã«æŠ‘åˆ¶

**ğŸ”´ å›°é›£3: é‡è¤‡ãƒ¢ãƒ‡ãƒ«ä½œæˆãƒªã‚¹ã‚¯**
- æ—¢å­˜ï¼š`organization_model.rs`, `team_model.rs`, `user_model.rs`
- å±é™ºï¼šæ–°è¦ã«`department_model.rs`ç­‰ã‚’ä½œæˆã™ã‚‹ã“ã¨
**å¯¾ç­–**:
- **æ—¢å­˜domain modelå®Œå…¨æ´»ç”¨**ï¼š`organization_department_model.rs`ç­‰ã¯å®Ÿè£…æ¸ˆã¿
- **æ—¢å­˜repositoryå®Œå…¨æ´»ç”¨**ï¼š`organization_department_repository.rs`ç­‰ã¯å®Ÿè£…æ¸ˆã¿
- æ–°è¦ä½œæˆã¯**Serviceãƒ»Handlerãƒ»DTOå±¤ã®ã¿**

**ğŸ”´ å›°é›£4: æ¨©é™ç¶™æ‰¿ã®è¤‡é›‘æ€§**
- çµ„ç¹”â†’éƒ¨é–€â†’ãƒãƒ¼ãƒ â†’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®4å±¤ç¶™æ‰¿
- å®ŸåŠ¹æ¨©é™è¨ˆç®—ã®è¤‡é›‘æ€§
**å¯¾ç­–**:
- æ—¢å­˜ã®å‹•çš„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ`domain/permission.rs`ï¼‰ã‚’æ‹¡å¼µ
- æ–°è¦æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ä½œæˆç¦æ­¢
- æ®µéšçš„æ¨©é™æ©Ÿèƒ½è¿½åŠ ï¼ˆåŸºæœ¬â†’ç¶™æ‰¿â†’å®ŸåŠ¹æ¨©é™åˆ†æï¼‰

**âœ… Phase 2.2æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®é©ç”¨**:
```rust
// æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šã‚·ãƒ³ãƒ—ãƒ«ãƒ»æ®µéšçš„ãƒ»æ—¢å­˜æ´»ç”¨
1. æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒ¢ãƒ‡ãƒ«ç¢ºèª âœ…
2. æœ€å°é™ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆå¿…è¦ãªå ´åˆã®ã¿ï¼‰
3. Serviceå±¤ã®ã¿æ–°è¦å®Ÿè£…
4. Handlerå±¤ã®ã¿æ–°è¦å®Ÿè£…  
5. HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ãƒ†ã‚¹ãƒˆ
6. #[allow(dead_code)]æ®µéšçš„å‰Šé™¤
```

**ğŸ¯ æ¨å¥¨å®Ÿè£…é †åº**:
1. **æ—¢å­˜ç¢ºèª**: organization_department_modelç­‰ã®è©³ç´°ç¢ºèª
2. **Serviceå®Ÿè£…**: æ—¢å­˜Repositoryã‚’æ´»ç”¨ã—ãŸServiceå±¤å®Œæˆ
3. **Handlerå®Ÿè£…**: æ—¢å­˜Serviceãƒ»DTOã‚’æ´»ç”¨ã—ãŸHandlerå±¤å®Œæˆ
4. **APIç™»éŒ²**: Routerçµ±åˆãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¬é–‹
5. **ãƒ†ã‚¹ãƒˆè¿½åŠ **: HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã®çµ±åˆãƒ†ã‚¹ãƒˆ
6. **Dead Codeå‰Šé™¤**: #[allow(dead_code)]æ®µéšçš„å‰Šé™¤

**ğŸš« çµ¶å¯¾å›é¿äº‹é …**:
- æ–°è¦domain modelä½œæˆï¼ˆæ—¢å­˜æ´»ç”¨å¿…é ˆï¼‰
- æ–°è¦repositoryä½œæˆï¼ˆæ—¢å­˜æ´»ç”¨å¿…é ˆï¼‰
- ç›´æ¥DBæ“ä½œãƒ†ã‚¹ãƒˆï¼ˆHTTPãƒ†ã‚¹ãƒˆæ¨å¥¨ï¼‰
- è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ä½œæˆ
- æ—¢å­˜æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ã¨é‡è¤‡ã™ã‚‹æ–°è¦æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ä½œæˆ

#### **ğŸ“‹ Phase 2.1 æ—¢å­˜å®Ÿè£…è©³ç´°èª¿æŸ»çµæœ**

**å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆé‡è¤‡å›é¿ã®ãŸã‚æ—¢å­˜æ´»ç”¨å¿…é ˆï¼‰**:

**ğŸ—‚ï¸ Domain Modelsï¼ˆ100%å®Ÿè£…æ¸ˆã¿ãƒ»æ´»ç”¨å¿…é ˆï¼‰**:
```bash
âœ… src/domain/organization_department_model.rs    # éƒ¨é–€ãƒ¢ãƒ‡ãƒ«ï¼ˆéšå±¤æ§‹é€ å¯¾å¿œï¼‰
âœ… src/domain/permission_matrix_model.rs          # æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
âœ… src/domain/organization_analytics_model.rs     # çµ„ç¹”åˆ†æãƒ¢ãƒ‡ãƒ«
âœ… src/domain/department_member_model.rs          # éƒ¨é–€ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†
```

**ğŸ—‚ï¸ Repository Layerï¼ˆ100%å®Ÿè£…æ¸ˆã¿ãƒ»æ´»ç”¨å¿…é ˆï¼‰**:
```bash
âœ… src/repository/organization_department_repository.rs    # éƒ¨é–€CRUDæ“ä½œ
âœ… src/repository/permission_matrix_repository.rs          # æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æ“ä½œ
âœ… src/repository/organization_analytics_repository.rs     # åˆ†æãƒ‡ãƒ¼ã‚¿æ“ä½œ
âœ… src/repository/department_member_repository.rs          # éƒ¨é–€ãƒ¡ãƒ³ãƒãƒ¼æ“ä½œ
```

**ğŸ—‚ï¸ Service Layerï¼ˆéƒ¨åˆ†å®Ÿè£…ãƒ»å®ŒæˆãŒå¿…è¦ï¼‰**:
```bash
âš ï¸ src/service/organization_hierarchy_service.rs          # çµ„ç¹”éšå±¤Serviceï¼ˆæœªå®Œæˆï¼‰
```

**ğŸ—‚ï¸ API Layerï¼ˆæœªå®Ÿè£…ãƒ»æ–°è¦ä½œæˆãŒå¿…è¦ï¼‰**:
```bash
âš ï¸ src/api/handlers/organization_hierarchy_handler.rs     # APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆæœªå®Œæˆï¼‰
âš ï¸ src/api/dto/organization_hierarchy_dto.rs              # DTOï¼ˆæœªå®Œæˆï¼‰
```

**ğŸ—‚ï¸ Databaseï¼ˆ100%å®Ÿè£…æ¸ˆã¿ãƒ»æ´»ç”¨å¿…é ˆï¼‰**:
```bash
âœ… migration/src/m20250624_000001_create_organization_departments_table.rs
âœ… migration/src/m20250624_000002_create_permission_matrices_table.rs
âœ… migration/src/m20250624_000003_create_organization_analytics_table.rs
âœ… migration/src/m20250624_000004_create_department_members_table.rs
```

**ğŸ” é‡è¤‡å›é¿ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:

**âœ… æ´»ç”¨ã™ã¹ãæ—¢å­˜å®Ÿè£…**:
- `OrganizationDepartmentRepository::create()` - éƒ¨é–€ä½œæˆ
- `OrganizationDepartmentRepository::find_by_organization_id()` - éƒ¨é–€æ¤œç´¢
- `PermissionMatrixRepository::create()` - æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¨­å®š
- `OrganizationAnalyticsRepository::find_by_organization_id()` - åˆ†æãƒ‡ãƒ¼ã‚¿å–å¾—
- `DepartmentMemberRepository::create()` - ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 

**ğŸš« ä½œæˆç¦æ­¢ï¼ˆé‡è¤‡å›é¿ï¼‰**:
- æ–°è¦department model variants
- æ–°è¦permission repository variants  
- æ–°è¦organization analytics variants
- é¡ä¼¼æ©Ÿèƒ½ã‚’æŒã¤é‡è¤‡ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒªãƒã‚¸ãƒˆãƒª

**ğŸ“ å®Ÿè£…æ™‚ã®å…·ä½“çš„æ‰‹é †**:

**Step 1: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ç†è§£**
```bash
# æ—¢å­˜å®Ÿè£…ã®è©³ç´°ç¢ºèª
grep -r "impl.*Department" src/domain/organization_department_model.rs
grep -r "impl.*Repository" src/repository/organization_department_repository.rs
```

**Step 2: Serviceå±¤å®Œæˆ**
```rust
// organization_hierarchy_service.rs ã®å®Œæˆ
// æ—¢å­˜Repositoryæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ï¼š
impl OrganizationHierarchyService {
    pub async fn create_department(&self, req: CreateDepartmentRequest) -> Result<...> {
        // æ—¢å­˜ã®OrganizationDepartmentRepository::create()æ´»ç”¨
        self.org_dept_repo.create(db, active_model).await
    }
}
```

**Step 3: Handlerå±¤å®Œæˆ**
```rust
// organization_hierarchy_handler.rs ã®å®Œæˆ
// æ—¢å­˜Serviceæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ï¼š
pub async fn create_department(
    State(app_state): State<AppState>,
    Path(org_id): Path<Uuid>,
    Json(req): Json<CreateDepartmentRequest>,
) -> Result<impl IntoResponse, AppError> {
    // æ—¢å­˜ã®OrganizationHierarchyServiceæ´»ç”¨
    let result = app_state.org_hierarchy_service.create_department(req).await?;
    Ok(Json(ApiResponse::success(result)))
}
```

### **æœ€çµ‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ»æœ€é©åŒ–**

- æ®‹å­˜ Dead Code å‰Šé™¤
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æº–å‚™

---

## ğŸ“ **çµè«–**

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ã¯**28 å€‹ã®æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ç›¸å½“ã®å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ãŠã‚Šï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºåŸºç›¤ã‚³ã‚¢æ©Ÿèƒ½+çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ï¼‰ã€ã“ã‚Œã‚‰ã‚’ä½“ç³»çš„ã« API ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã“ã¨ã§ï¼š

**âœ… å®Ÿè£…å®Œäº†åˆ† (18ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**:
1. **ğŸ“ˆ 23%ã® API æ©Ÿèƒ½æ‹¡å¼µ**ï¼ˆ78 â†’ 96 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
2. **ğŸ¢ é«˜åº¦ç®¡ç†ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒãƒ¼ãƒ æ‹›å¾…æ©Ÿèƒ½**å®Œå‚™
3. **ğŸ’° ãƒãƒ¼ãƒ å”æ¥­ãƒ»æ‹›å¾…ç®¡ç†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **åŒ–
4. **ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ»ãƒãƒ¼ãƒ æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ã®å®Œå…¨å®Ÿè£…**

**âŒ æœªå®Ÿè£…åˆ† (10ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**:
- Phase 2.1: çµ„ç¹”éšå±¤ç®¡ç† API

**å‰Šé™¤ã™ã¹ãçœŸã®ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰**ã¯å…¨ä½“ã® 10%æœªæº€ã§ã‚ã‚Šã€90%ä»¥ä¸Šã¯**é«˜ã„æ±ç”¨æ€§ã¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºä¾¡å€¤**ã‚’æŒã¤ã‚³ã‚¢æ©Ÿèƒ½ã§ã™ã€‚

---

## ğŸ”¬ **Dead Code å‰Šæ¸›åŠ¹æœã®è©³ç´°åˆ†æ**

_2025-01-22 è¿½è¨˜: 78 â†’ 123 API æ‹¡å¼µã«ã‚ˆã‚‹ Dead Code å‰Šæ¸›åŠ¹æœã®å®šé‡åˆ†æ_

### ğŸ“Š **ç¾çŠ¶ã® Dead Code è©³ç´°åˆ†æ**

#### **ç·åˆçµ±è¨ˆ**

- **ç¾åœ¨ã®`#[allow(dead_code)]`ç·æ•°**: 191 å€‹ã®é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰
- **API åŒ–å¯èƒ½ãªæ©Ÿèƒ½**: 170 å€‹ (89.0%)
- **çœŸã® dead code**: 15-20 å€‹ (8.0-10.0%)
- **å†…éƒ¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: 6-10 å€‹ (3.0-5.0%)

#### **ã‚«ãƒ†ã‚´ãƒªåˆ¥è©³ç´°åˆ†æ**

##### **ğŸ”§ Phase 1 ã§è§£æ¶ˆã•ã‚Œã‚‹ Dead Code (60 å€‹ - 31.4%)**

```rust
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ (15å€‹ã®é–¢æ•°)
UserRepository::find_all()                    â†’ GET /admin/users/advanced-search
UserRepository::find_active_users()           â†’ GET /admin/users/analytics
UserRepository::find_by_username()            â†’ GET /admin/users/by-username/{username}
UserRepository::find_paginated()              â†’ GET /admin/users/paginated
UserRepository::is_username_taken()           â†’ GET /admin/users/username-check
UserRepository::update_subscription_tier()    â†’ PUT /admin/users/{id}/subscription
UserRepository::find_by_role()                â†’ GET /admin/users/by-role/{role}
UserRepository::find_by_subscription_tier()   â†’ GET /admin/users/by-subscription
UserRepository::get_user_stats()              â†’ GET /admin/users/statistics
UserRepository::search_users()                â†’ POST /admin/users/search
UserRepository::bulk_update_users()           â†’ POST /admin/users/bulk-operations
UserRepository::activate_user()               â†’ PUT /admin/users/{id}/activate
UserRepository::deactivate_user()             â†’ PUT /admin/users/{id}/deactivate
UserRepository::get_user_activity()           â†’ GET /admin/users/{id}/activity
UserRepository::find_users_by_email_domain()  â†’ GET /admin/users/by-email-domain

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç† (20å€‹ã®é–¢æ•°)
RefreshTokenRepository::get_token_stats()      â†’ GET /admin/security/token-stats
RefreshTokenRepository::cleanup_expired()     â†’ POST /admin/security/cleanup-tokens
RefreshTokenRepository::revoke_all_user()     â†’ POST /admin/security/revoke-all-tokens
RefreshTokenRepository::get_active_count()    â†’ GET /admin/security/active-tokens
RefreshTokenRepository::get_user_sessions()   â†’ GET /admin/security/user-sessions
PasswordResetRepository::get_token_stats()    â†’ GET /admin/security/password-resets
PasswordResetRepository::cleanup_expired()    â†’ POST /admin/security/cleanup-password-resets
PasswordResetRepository::get_recent_activity() â†’ GET /admin/security/recent-activity
// ... ãã®ä»–12å€‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£é–¢æ•°

// é«˜åº¦ãªã‚¿ã‚¹ã‚¯ç®¡ç†æ©Ÿèƒ½ (12å€‹ã®é–¢æ•°)
TaskService::create_task_global()             â†’ POST /admin/tasks/create
TaskService::update_task_global()             â†’ PUT /admin/tasks/{id}
TaskService::delete_task_global()             â†’ DELETE /admin/tasks/{id}
TaskService::list_tasks_all_users()           â†’ GET /admin/tasks/cross-user-analytics
TaskService::list_tasks_paginated()           â†’ GET /admin/tasks/paginated
TaskService::create_tasks_batch()             â†’ POST /admin/tasks/bulk-create
TaskService::update_tasks_batch()             â†’ PUT /admin/tasks/bulk-update
TaskService::delete_tasks_batch()             â†’ DELETE /admin/tasks/bulk-delete
TaskService::get_task_statistics()            â†’ GET /admin/tasks/statistics
TaskService::get_system_health()              â†’ GET /admin/tasks/system-health
TaskService::migrate_user_tasks()             â†’ POST /admin/tasks/migrate-user
TaskService::reassign_tasks()                 â†’ POST /admin/tasks/bulk-reassign

// èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ (8å€‹ã®é–¢æ•°)
auth::admin_only_middleware()                 â†’ ç®¡ç†è€…å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
auth::role_aware_auth_middleware()            â†’ ãƒ­ãƒ¼ãƒ«èªè­˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
auth::optional_auth_middleware()              â†’ ä»»æ„èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
auth::permission_checker()                    â†’ æ¨©é™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
// ... ãã®ä»–4å€‹ã®èªè¨¼é–¢é€£é–¢æ•°
```

##### **ğŸ¢ Phase 2 ã§è§£æ¶ˆã•ã‚Œã‚‹ Dead Code (50 å€‹ - 26.2%)**

```rust
// çµ„ç¹”ç®¡ç†æ©Ÿèƒ½ (20å€‹ã®é–¢æ•°)
OrganizationService::create_organization()     â†’ POST /organizations
OrganizationService::get_organization_hierarchy() â†’ GET /organizations/{id}/hierarchy
OrganizationService::create_department()       â†’ POST /organizations/{id}/departments
OrganizationService::get_analytics()           â†’ GET /organizations/{id}/analytics
OrganizationService::update_subscription()     â†’ PUT /organizations/{id}/subscription
OrganizationService::get_cross_tenant_stats()  â†’ GET /organizations/cross-tenant-stats
OrganizationService::export_organization_data() â†’ POST /organizations/{id}/data-export
// ... ãã®ä»–13å€‹ã®çµ„ç¹”é–¢é€£é–¢æ•°

// ãƒãƒ¼ãƒ å”æ¥­æ©Ÿèƒ½ (15å€‹ã®é–¢æ•°)
TeamService::get_performance_analytics()      â†’ GET /teams/{id}/performance-analytics
TeamService::create_workflow_template()       â†’ POST /teams/{id}/workflow-templates
TeamService::get_collaboration_stats()        â†’ GET /teams/{id}/collaboration-stats
TeamService::bulk_invite_members()            â†’ POST /teams/{id}/bulk-member-invite
TeamService::get_cross_team_insights()        â†’ GET /teams/cross-team-insights
TeamService::update_permission_matrix()       â†’ PUT /teams/{id}/permission-matrix
// ... ãã®ä»–9å€‹ã®ãƒãƒ¼ãƒ é–¢é€£é–¢æ•°

// ãƒãƒƒãƒå‡¦ç†ãƒ»ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ (10å€‹ã®é–¢æ•°)
BatchService::process_user_migration()        â†’ POST /admin/batch/user-migration
BatchService::process_task_cleanup()          â†’ POST /admin/batch/task-cleanup
BatchService::process_data_export()           â†’ POST /admin/batch/data-export
// ... ãã®ä»–7å€‹ã®ãƒãƒƒãƒå‡¦ç†é–¢æ•°

// é«˜åº¦ãªæ¨©é™ç®¡ç† (5å€‹ã®é–¢æ•°)
PermissionService::calculate_effective_permissions() â†’ æ¨©é™è¨ˆç®—API
PermissionService::update_permission_matrix()  â†’ æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æ›´æ–°
// ... ãã®ä»–3å€‹ã®æ¨©é™é–¢é€£é–¢æ•°
```

### ğŸ—‘ï¸ **æ®‹å­˜ã™ã‚‹ Dead Code (15-25 å€‹ - 8-13%)**

#### **å‰Šé™¤æ¨å¥¨ã®çœŸã® Dead Code (15-20 å€‹)**

```rust
// è¨­å®šãƒ»ç’°å¢ƒé–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (ä½ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤)
UserRepository::with_schema()                 // é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨
RefreshTokenRepository::with_schema()          // é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨
PasswordResetTokenRepository::with_schema()    // é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨
EmailService::from_env()                       // EmailConfig::defaultã§ä»£æ›¿å¯èƒ½

// é‡è¤‡ãƒ»çµ±åˆå¯èƒ½ãªæ©Ÿèƒ½
EmailService::determine_email_provider()       // æ—¢å­˜æ©Ÿèƒ½ã¨é‡è¤‡
EmailService::mask_email()                     // ä½¿ç”¨é »åº¦æ¥µä½
ä¸€éƒ¨ã®email template helper methods            // çµ±åˆå¯èƒ½

// ä¸å®Œå…¨ãƒ»å®Ÿé¨“çš„å®Ÿè£…
ä¸€éƒ¨ã®configurationæ§‹é€ ä½“ã®æœªä½¿ç”¨field        // é–‹ç™ºæ™‚ã®æ®‹å­˜
ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ­ã‚°ç”¨helper functions               // ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦
```

#### **ä¿æŒæ¨å¥¨ã®å†…éƒ¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (5-10 å€‹)**

```rust
// å†…éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹åŸºç›¤æ©Ÿèƒ½
PasswordConfig::validate_strength()           // å†…éƒ¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
JwtConfig::generate_secret()                  // å†…éƒ¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
DatabaseConfig::create_connection_pool()      // å†…éƒ¨æ¥ç¶šç®¡ç†
```

### ğŸ“ˆ **å‰Šæ¸›åŠ¹æœã®å®šé‡åˆ†æ**

#### **Phase åˆ¥å‰Šæ¸›åŠ¹æœ**

| Phase                   | å‰Šæ¸›ã™ã‚‹ Dead Code | å‰Šæ¸›ç‡     | ç´¯ç©å‰Šæ¸›ç‡     | æ–°è¦ API æ•°       |
| ----------------------- | ------------------ | ---------- | -------------- | ----------------- |
| **Phase 1**             | 55 å€‹              | 28.8%      | 28.8%          | 13 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| **Phase 2**             | 50 å€‹              | 26.2%      | 55.0%          | 17 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| **çœŸã® Dead Code å‰Šé™¤** | 50-55 å€‹           | 26.2-28.8% | **83.8-86.4%** | -                 |

#### **æœ€çµ‚çš„ãªå‰Šæ¸›åŠ¹æœ**

- **å‰Šæ¸›å‰**: 191 å€‹ã®`#[allow(dead_code)]`
- **å‰Šæ¸›å¾Œ**: 25-30 å€‹ã®`#[allow(dead_code)]`ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ç‰¹åŒ–ï¼‰
- **ç·å‰Šæ¸›ç‡**: **83.8-86.4%**
- **API åŒ–ã•ã‚Œã‚‹æ©Ÿèƒ½**: **125-135 å€‹** (ã‚³ã‚¢æ©Ÿèƒ½ä¸­å¿ƒ)

### ğŸ¯ **æ¬¡æœŸãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æˆ¦ç•¥**

#### **å³åº§ã«å‰Šé™¤å¯èƒ½ï¼ˆãƒªã‚¹ã‚¯ãªã—ï¼‰**

```rust
// Phase 1å®Ÿè£…å‰ã«å‰Šé™¤æ¨å¥¨
EmailService::from_env()                      // å³åº§ã«å‰Šé™¤å¯èƒ½
EmailService::determine_email_provider()      // å³åº§ã«å‰Šé™¤å¯èƒ½
*Repository::with_schema() methods            // å³åº§ã«å‰Šé™¤å¯èƒ½ï¼ˆ5å€‹ï¼‰
```

#### **Phase å®Ÿè£…ã¨åŒæ™‚ã«å‰Šé™¤**

```rust
// Phase 1å®Ÿè£…æ™‚
UserRepository dead code functions â†’ APIå®Ÿè£…ã¨åŒæ™‚ã«#[allow(dead_code)]å‰Šé™¤

// Phase 2å®Ÿè£…æ™‚
OrganizationService dead code functions â†’ APIå®Ÿè£…ã¨åŒæ™‚ã«å‰Šé™¤

```

#### **æœ€çµ‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**

```rust
// å…¨Phaseå®Œäº†å¾Œ
æ®‹å­˜ã™ã‚‹5-10å€‹ã®çœŸã®dead code â†’ ä¸€æ‹¬å‰Šé™¤
å†…éƒ¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®æ•´ç† â†’ å¿…è¦æ€§å†è©•ä¾¡
```

### ğŸ“Š **å®Ÿè£…åŠ¹æœã®äºˆæ¸¬**

#### **ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å¥å…¨æ€§å‘ä¸Š**

- **Dead Code**: 191 å€‹ â†’ 5-10 å€‹ (94.8-97.4%å‰Šæ¸›)
- **æ©Ÿèƒ½æ´»ç”¨ç‡**: 89.0% â†’ 97.4-98.7%
- **ä¿å®ˆæ€§**: å¤§å¹…å‘ä¸Šï¼ˆä¸è¦ã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼‰
- **å¯èª­æ€§**: å‘ä¸Šï¼ˆAPI ç›®çš„ãŒæ˜ç¢ºï¼‰

#### **ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã®æœ€å¤§åŒ–**

- **API æ©Ÿèƒ½æ€§**: 78 â†’ 123 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (58%å¢—åŠ )
- **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œ**: åŸºæœ¬ãƒ¬ãƒ™ãƒ« â†’ åŒ…æ‹¬çš„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
- **ç«¶äº‰å„ªä½æ€§**: ã‚¿ã‚¹ã‚¯ç®¡ç† â†’ çµ„ç¹”ç®¡ç†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
- **åç›Šãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤ã®å®Œå…¨æ´»ç”¨

### ğŸš€ **æ¨å¥¨å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

1. **å³åº§ã«å®Ÿè¡Œ** (1-2 æ—¥): çœŸã® Dead Code å‰Šé™¤ï¼ˆãƒªã‚¹ã‚¯ãªã—ï¼‰
2. **Phase 1** (2-3 é€±é–“): ç®¡ç†è€…æ©Ÿèƒ½ API å®Ÿè£… + Dead Code å‰Šé™¤
3. **Phase 2** (3-4 é€±é–“): çµ„ç¹”ãƒ»ãƒãƒ¼ãƒ æ©Ÿèƒ½ API å®Ÿè£… + Dead Code å‰Šé™¤
4. **æœ€çµ‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—** (1 é€±é–“): æ®‹å­˜ Dead Code æ•´ç†ãƒ»æœ€é©åŒ–

ã“ã®åŠ¹ç‡çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€**8 é€±é–“ã§ 84-86%ã® Dead Code å‰Šé™¤ã¨ 45%ã® API æ©Ÿèƒ½æ‹¡å¼µ**ã‚’åŒæ™‚ã«å®Ÿç¾ã§ãã¾ã™ã€‚

---

## ğŸ“‹ **æ–°è¦ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½æ¦‚è¦ä¸€è¦§**

_å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å®Ÿç¾å¯èƒ½ãªæ©Ÿèƒ½ã®è©³ç´°æ¦‚è¦ï¼ˆ100 å­—ä»¥å†…ï¼‰_

### ğŸ”§ **Phase 1: ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¼·åŒ–** (18 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)

#### **1.1 é«˜åº¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† API (6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                      | æ©Ÿèƒ½æ¦‚è¦                                                                                                                                         |
| ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `GET /admin/users/advanced-search`  | è¤‡æ•°æ¡ä»¶ã§ã®é«˜åº¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã€‚ãƒ­ãƒ¼ãƒ«ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ç™»éŒ²æ—¥ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£çŠ¶æ³ç­‰ã®çµ„ã¿åˆã‚ã›æ¤œç´¢ãŒå¯èƒ½ã€‚CRMãƒ»HR ç­‰å…¨ã‚·ã‚¹ãƒ†ãƒ ã§å¿œç”¨å¯èƒ½ã€‚ |
| `GET /admin/users/analytics`        | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨ä½“ã®çµ±è¨ˆåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€‚ç™»éŒ²æ•°æ¨ç§»ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç‡ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ†å¸ƒãƒ»åœ°åŸŸåˆ¥åˆ†æç­‰ã‚’å¯è¦–åŒ–ã€‚å£²ä¸Šãƒ»é¡§å®¢åˆ†æç­‰ã§æ±ç”¨å¿œç”¨ã€‚       |
| `GET /admin/users/by-role/{role}`   | æŒ‡å®šãƒ­ãƒ¼ãƒ«ï¼ˆadmin/member/viewerï¼‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ã€‚æ¨©é™ç®¡ç†ãƒ»çµ„ç¹”æ§‹é€ æŠŠæ¡ãƒ»ãƒ­ãƒ¼ãƒ«åˆ¥é‹ç”¨çŠ¶æ³ã®ç›£è¦–ã€‚å…¨ RBAC ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤æ©Ÿèƒ½ã€‚                |
| `GET /admin/users/by-subscription`  | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æã€‚Free/Pro/Enterprise å„å±¤ã®åˆ©ç”¨çŠ¶æ³ãƒ»åç›Šåˆ†æãƒ»ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²å¯¾è±¡ã®ç‰¹å®šã€‚é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç®¡ç†ã§å¿œç”¨ã€‚     |
| `GET /admin/users/activity-stats`   | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è©³ç´°çµ±è¨ˆã€‚ãƒ­ã‚°ã‚¤ãƒ³é »åº¦ãƒ»æ©Ÿèƒ½åˆ©ç”¨çŠ¶æ³ãƒ»ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆæŒ‡æ¨™ã‚’åˆ†æã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»UX æ”¹å–„ãƒ»é‹ç”¨ç›£è¦–ã§å¿…é ˆæ©Ÿèƒ½ã€‚              |
| `POST /admin/users/bulk-operations` | è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€æ‹¬æ“ä½œï¼ˆæœ‰åŠ¹åŒ–ãƒ»ç„¡åŠ¹åŒ–ãƒ»ãƒ­ãƒ¼ãƒ«å¤‰æ›´ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ›´æ–°ï¼‰ã€‚å¤§è¦æ¨¡ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ãƒ»HRãƒ»CRMãƒ»åœ¨åº«ç®¡ç†ç­‰ã§å¿…é ˆã®åŸºç›¤æ©Ÿèƒ½ã€‚          |

#### **1.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç† API (7 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                           | æ©Ÿèƒ½æ¦‚è¦                                                                                                                       |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `GET /admin/security/token-stats`        | èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³åˆ©ç”¨çµ±è¨ˆã®è©³ç´°åˆ†æã€‚ç™ºè¡Œæ•°ãƒ»æœ‰åŠ¹æœŸé™ãƒ»åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ç•°å¸¸æ¤œçŸ¥ç­‰ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³ã®å¯è¦–åŒ–ã¨ç›£è¦–ã‚’å®Ÿç¾ã€‚       |
| `GET /admin/security/refresh-tokens`     | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³çŠ¶æ³ã®ç›£è¦–æ©Ÿèƒ½ã€‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ç•°å¸¸ãƒ­ã‚°ã‚¤ãƒ³ãƒ»å¤šé‡ãƒ­ã‚°ã‚¤ãƒ³ç­‰ã‚’æ¤œå‡ºã—ã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹å¯¾ç­–ã‚’å¼·åŒ–ã€‚       |
| `POST /admin/security/cleanup-tokens`    | æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•å‰Šé™¤ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€‚ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¶­æŒãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯è»½æ¸›ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ã‚’è‡ªå‹•å®Ÿè¡Œã€‚ |
| `GET /admin/security/password-resets`    | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ´»å‹•ã®ç›£è¦–ãƒ»åˆ†æã€‚ãƒªã‚»ãƒƒãƒˆé »åº¦ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»æ½œåœ¨çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’ç‰¹å®šã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆå‘ä¸Šã«è²¢çŒ®ã€‚     |
| `POST /admin/security/revoke-all-tokens` | ç·Šæ€¥æ™‚å…¨ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–æ©Ÿèƒ½ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ»ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥æ™‚ã®è¿…é€Ÿãªå¯¾å¿œã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å®‰å…¨æ€§ã‚’ç¢ºä¿ã€‚       |
| `GET /admin/security/session-analytics`  | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°åˆ†æã€‚ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“ãƒ»æ¥ç¶šåœ°åŸŸãƒ»ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ãƒ»ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ç­‰ã‚’ç›£è¦–ã—ã€é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã‚’æä¾›ã€‚       |
| `POST /admin/security/audit-report`      | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã€‚ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ãƒ»æ¨©é™å¤‰æ›´ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆç­‰ã‚’åŒ…æ‹¬çš„ã«åˆ†æã—ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œã‚’ã‚µãƒãƒ¼ãƒˆã€‚ |

#### **1.3 ãã®ä»–ç®¡ç†æ©Ÿèƒ½ API (1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                    | æ©Ÿèƒ½æ¦‚è¦                                                                                                           |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| `GET /admin/users/username-check` | ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ãƒ»å¯ç”¨æ€§ç¢ºèªã€‚æ–°è¦ç™»éŒ²ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åå¤‰æ›´æ™‚ã®å³åº§ãªæ¤œè¨¼ã«ã‚ˆã‚Šã€ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã€‚ |

### ğŸ¢ **Phase 2: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ„ç¹”æ©Ÿèƒ½** (17 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)

#### **2.1 çµ„ç¹”éšå±¤ç®¡ç† API (10 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                                     | æ©Ÿèƒ½æ¦‚è¦                                                                                                                             |
| -------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `GET /organizations/{id}/hierarchy`                | çµ„ç¹”éšå±¤æ§‹é€ ã®å–å¾—ãƒ»å¯è¦–åŒ–ã€‚éƒ¨é–€ãƒ»ãƒãƒ¼ãƒ ãƒ»ãƒ¡ãƒ³ãƒãƒ¼ã®å…¥ã‚Œå­é–¢ä¿‚ã‚’éšå±¤è¡¨ç¤ºã€‚æ”¯åº—ãƒ»äº‹æ¥­éƒ¨ãƒ»è²©å£²ç¶²ç­‰ã®éšå±¤ç®¡ç†ã§æ±ç”¨å¿œç”¨å¯èƒ½ã€‚           |
| `POST /organizations/{id}/departments`             | éšå±¤å…¥ã‚Œå­éƒ¨é–€ã®ä½œæˆæ©Ÿèƒ½ã€‚è¦ªéƒ¨é–€é…ä¸‹ã¸ã®å­éƒ¨é–€ä½œæˆãƒ»ç„¡åˆ¶é™éšå±¤å¯¾å¿œã€‚åº—èˆ—ãƒ»äº‹æ¥­éƒ¨ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç­‰ã®çµ„ç¹”å˜ä½ç®¡ç†ã§æ±ç”¨å¿œç”¨ã€‚           |
| `GET /organizations/{id}/departments`              | éƒ¨é–€ä¸€è¦§ãƒ»éšå±¤æ§‹é€ è¡¨ç¤ºã€‚å…¨éƒ¨é–€ã®è¦ªå­é–¢ä¿‚ãƒ»éšå±¤ãƒ¬ãƒ™ãƒ«ãƒ»é…ç½®çŠ¶æ³ã‚’è¡¨ç¤ºã€‚çµ„ç¹”å›³ãƒ»ç®¡ç†ç”»é¢ãƒ»åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ´»ç”¨ã€‚                   |
| `PUT /organizations/{id}/departments/{dept_id}`    | éƒ¨é–€æƒ…å ±ãƒ»éšå±¤ä½ç½®ã®æ›´æ–°ã€‚éƒ¨é–€åãƒ»èª¬æ˜ãƒ»è¦ªéƒ¨é–€å¤‰æ›´ãƒ»éšå±¤ç§»å‹•å¯¾å¿œã€‚çµ„ç¹”å†ç·¨ãƒ»çµ±åˆãƒ»åˆ†å‰²æ™‚ã®æŸ”è»Ÿãªæ§‹é€ å¤‰æ›´ã‚’å®Ÿç¾ã€‚                     |
| `DELETE /organizations/{id}/departments/{dept_id}` | éƒ¨é–€å‰Šé™¤ï¼ˆå­éƒ¨é–€è‡ªå‹•ç§»å‹•å‡¦ç†ï¼‰ã€‚å‰Šé™¤éƒ¨é–€é…ä¸‹ã®å­éƒ¨é–€ãƒ»ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¦ªéƒ¨é–€ã«è‡ªå‹•ç§»å‹•ã€‚å®‰å…¨ãªçµ„ç¹”æ§‹é€ å¤‰æ›´ã‚’ä¿è¨¼ã™ã‚‹åŸºç›¤æ©Ÿèƒ½ã€‚             |
| `GET /organizations/{id}/analytics`                | çµ„ç¹”éšå±¤åˆ¥åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€‚éƒ¨é–€åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»éšå±¤åŠ¹ç‡ãƒ»ãƒªã‚½ãƒ¼ã‚¹é…åˆ†ç­‰ã‚’å¯è¦–åŒ–ã€‚å£²ä¸Šãƒ»äººäº‹ãƒ»é‹ç”¨åˆ†æã§æ±ç”¨å¿œç”¨ã€‚               |
| `PUT /organizations/{id}/permission-matrix`        | çµ„ç¹”å˜ä½è©³ç´°æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¨­å®šã€‚çµ„ç¹”å…¨ä½“ãƒ»é…ä¸‹å…¨ãƒãƒ¼ãƒ ãƒ»å…¨éƒ¨é–€ã«é©ç”¨ã•ã‚Œã‚‹åŒ…æ‹¬æ¨©é™åˆ¶å¾¡ã€‚ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºçµ±ä¸€ã‚¬ãƒãƒŠãƒ³ã‚¹ã§å¿…é ˆã€‚     |
| `GET /organizations/{id}/permission-matrix`        | çµ„ç¹”é©ç”¨æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å–å¾—ã€‚çµ„ç¹”ãƒ¬ãƒ™ãƒ«æ¨©é™è¨­å®šãƒ»é…ä¸‹ç¶™æ‰¿ãƒ«ãƒ¼ãƒ«ãƒ»ä¾‹å¤–è¨­å®šã‚’åŒ…æ‹¬è¡¨ç¤ºã€‚çµ„ç¹”ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ»ç›£æŸ»ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã§æ´»ç”¨ã€‚ |
| `GET /organizations/{id}/effective-permissions`    | çµ„ç¹”å®ŸåŠ¹æ¨©é™åˆ†æã€‚çµ„ç¹”ãƒ»éƒ¨é–€ãƒ»ãƒãƒ¼ãƒ ãƒ»å€‹äººãƒ¬ãƒ™ãƒ«ã®æ¨©é™ç¶™æ‰¿ãƒã‚§ãƒ¼ãƒ³ã¨æœ€çµ‚é©ç”¨æ¨©é™ã‚’è©³ç´°åˆ†æã€‚æ¨©é™æœ€é©åŒ–ãƒ»ç›£æŸ»ãƒ»ãƒ‡ãƒãƒƒã‚°ã§å¿…é ˆã€‚       |
| `POST /organizations/{id}/data-export`             | çµ„ç¹”ãƒ‡ãƒ¼ã‚¿ã®éšå±¤æ§‹é€ ä¿æŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚çµ„ç¹”å›³ãƒ»éƒ¨é–€é…ç½®ãƒ»ãƒ¡ãƒ³ãƒãƒ¼é–¢ä¿‚ã‚’å«ã‚€åŒ…æ‹¬çš„ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã€‚GDPRãƒ»ç§»è¡Œãƒ»ç›£æŸ»ã§å¿…é ˆæ©Ÿèƒ½ã€‚             |

#### **2.2 ãƒãƒ¼ãƒ æ‹›å¾…ãƒ»æ¨©é™ç®¡ç† API (6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                                    | æ©Ÿèƒ½æ¦‚è¦                                                                                                                                     |
| ------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| `POST /teams/{id}/bulk-member-invite`             | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€æ‹¬æ‹›å¾…æ©Ÿèƒ½ã€‚å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»çµ„ç¹”æ‹¡å¤§ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå‚åŠ ç­‰ã§ã®åŠ¹ç‡çš„ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»éƒ¨ç½²ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã§æ±ç”¨å¿œç”¨ã€‚ |
| `GET /teams/{id}/invitations`                     | æ‹›å¾…çŠ¶æ³ç¢ºèªãƒ»ç®¡ç†æ©Ÿèƒ½ã€‚é€ä¿¡æ¸ˆã¿æ‹›å¾…ãƒ»å›ç­”å¾…ã¡ãƒ»æ‰¿èªçŠ¶æ³ç­‰ã®ä¸€å…ƒç®¡ç†ã€‚HRãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶ã§æ´»ç”¨å¯èƒ½ã€‚                         |
| `PUT /teams/{id}/invitations/{invite_id}/decline` | æ‹›å¾…è¾é€€æ©Ÿèƒ½ï¼ˆæ‹›å¾…ã¨ã‚»ãƒƒãƒˆå®Ÿè£…ï¼‰ã€‚ä¸å¯§ãªè¾é€€ãƒ•ãƒ­ãƒ¼ãƒ»ç†ç”±è¨˜éŒ²ãƒ»ä»£æ›¿ææ¡ˆç­‰ã‚’ã‚µãƒãƒ¼ãƒˆã€‚çµ„ç¹”å¤‰æ›´ãƒ»å‚åŠ ç®¡ç†ã§å¿…é ˆã®åŸºç›¤æ©Ÿèƒ½ã€‚                     |
| `PUT /teams/{id}/permission-matrix`               | ãƒãƒ¼ãƒ å˜ä½è©³ç´°æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¨­å®šã€‚ãƒãƒ¼ãƒ å›ºæœ‰ã®ãƒªã‚½ãƒ¼ã‚¹ãƒ»æ©Ÿèƒ½ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ç´°ã‹ãåˆ¶å¾¡ã€‚å…¨ RBAC ã‚·ã‚¹ãƒ†ãƒ ã§æ´»ç”¨å¯èƒ½ãªæ±ç”¨æ¨©é™åŸºç›¤ã€‚   |
| `GET /teams/{id}/permission-matrix`               | ãƒãƒ¼ãƒ é©ç”¨æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å–å¾—ã€‚ç¾åœ¨ã®ãƒãƒ¼ãƒ æ¨©é™è¨­å®šãƒ»ç¶™æ‰¿çŠ¶æ³ãƒ»åˆ¶é™äº‹é …ã‚’åŒ…æ‹¬çš„ã«è¡¨ç¤ºã€‚æ¨©é™ç®¡ç†ãƒ»ç›£æŸ»ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆã§æ´»ç”¨ã€‚             |
| `GET /teams/{id}/effective-permissions`           | ãƒãƒ¼ãƒ å®ŸåŠ¹æ¨©é™åˆ†æã€‚çµ„ç¹”ç¶™æ‰¿ãƒ»ãƒãƒ¼ãƒ è¨­å®šãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã‚’çµ±åˆã—ãŸæœ€çµ‚é©ç”¨æ¨©é™ã‚’è©³ç´°è¡¨ç¤ºã€‚æ¨©é™ãƒ‡ãƒãƒƒã‚°ãƒ»ç›£æŸ»ãƒ»æœ€é©åŒ–ã§å¿…é ˆã€‚                 |


### ğŸ“Š **API æ©Ÿèƒ½æ¦‚è¦ã‚µãƒãƒªãƒ¼**

#### **Phase åˆ¥æ©Ÿèƒ½ä¾¡å€¤**

| Phase       | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•° | ä¸»è¦ä¾¡å€¤                                   | å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼               |
| ----------- | ---------------- | ------------------------------------------ | -------------------------- |
| **Phase 1** | 18               | ç®¡ç†åŠ¹ç‡åŒ–ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ãƒ»é‹ç”¨è‡ªå‹•åŒ–   | ç®¡ç†è€…ãƒ»é‹ç”¨ãƒãƒ¼ãƒ          |
| **Phase 2** | 17               | çµ„ç¹”éšå±¤ç®¡ç†ãƒ»çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ»æ‹›å¾…ç®¡ç† | çµ„ç¹”ç®¡ç†è€…ãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ |

#### **æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†å¸ƒï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºåŸºç›¤+çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ï¼‰**

- **ç®¡ç†ãƒ»é‹ç”¨**: 11 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (31%)
- **çµ„ç¹”éšå±¤ç®¡ç†**: 10 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (29%)
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹**: 7 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (20%)
- **çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹**: 6 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (17%)
- **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿**: 1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (3%)

ã“ã® 35 å€‹ã®æ–°è¦ API ã«ã‚ˆã‚Šã€åŸºæœ¬çš„ãªã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‹ã‚‰**æ±ç”¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åŸºç›¤ï¼ˆçµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹å®Œå‚™ï¼‰**ã¸ã®é€²åŒ–ã‚’å®Ÿç¾ã€‚CRMãƒ»ERPãƒ»HRãƒ»EC ç­‰ã‚ã‚‰ã‚†ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ 100%å¿œç”¨å¯èƒ½ãªåŸºç›¤æ©Ÿèƒ½ã‚’æä¾›ã€‚

### **ğŸ”„ Phaseå®Ÿè£…ã®æ•™è¨“ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

#### **âœ… Phase 2.2 æˆåŠŸè¦å› ï¼ˆä»Šå¾Œã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰**:

**1. æ®µéšçš„ãƒ»ã‚·ãƒ³ãƒ—ãƒ«å®Ÿè£…**:
- æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«1ã¤ã®ã¿ï¼ˆteam_invitationsï¼‰
- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆteamsï¼‰ã¸ã®ä¾å­˜ã‚’æœ€å°åŒ–
- è¤‡é›‘ãªå¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚’å›é¿

**2. æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³å®Œå…¨æ´»ç”¨**:
- æ—¢å­˜team_model.rsã®æ‹¡å¼µï¼ˆæ–°è¦modelä½œæˆã›ãšï¼‰
- æ—¢å­˜èªè¨¼ãƒ»æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ã®æ´»ç”¨
- æ—¢å­˜DTOãƒ»Handleræ§‹é€ ã®è¸è¥²

**3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®æœ€é©åŒ–**:
- HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- ç›´æ¥DBæ“ä½œãƒ†ã‚¹ãƒˆã®æœ€å°åŒ–
- æ¥ç¶šãƒ—ãƒ¼ãƒ«æ¯æ¸‡å›é¿

#### **âš ï¸ Phase 2.1 å›°é›£è¦å› ï¼ˆå›é¿ã™ã¹ãã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰**:

**1. è¤‡é›‘ãªä¾å­˜é–¢ä¿‚**:
- 4ãƒ†ãƒ¼ãƒ–ãƒ«åŒæ™‚å®Ÿè£…ã®è¤‡é›‘æ€§
- å¾ªç’°å‚ç…§ãƒ»ç›¸äº’ä¾å­˜ã®ç™ºç”Ÿ
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®æ¥ç¶šãƒ—ãƒ¼ãƒ«æ¯æ¸‡

**2. é‡è¤‡å®Ÿè£…ãƒªã‚¹ã‚¯**:
- é¡ä¼¼ãƒ¢ãƒ‡ãƒ«ã®ä¹±ç«‹ï¼ˆorganizationã¨departmentï¼‰
- æ¨©é™ã‚·ã‚¹ãƒ†ãƒ ã®é‡è¤‡å®Ÿè£…
- æ—¢å­˜æ©Ÿèƒ½ã¨ã®éäº’æ›æ€§

#### **ğŸ¯ Phase 2.1 æˆåŠŸã®ãŸã‚ã®æˆ¦ç•¥ä¿®æ­£**:

**æˆ¦ç•¥1: æœ€å°å®Ÿè£…å˜ä½**
```rust
// âŒ å¾“æ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
Phase 2.1 = å…¨10ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŒæ™‚å®Ÿè£…

// âœ… æ–°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆæˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰  
Phase 2.1a = éƒ¨é–€ç®¡ç†APIï¼ˆ3ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
Phase 2.1b = æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼ˆ3ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
Phase 2.1c = åˆ†æãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆ4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
```

**æˆ¦ç•¥2: æ—¢å­˜æ´»ç”¨æœ€å¤§åŒ–**
```rust
// âœ… æ—¢å­˜Repository 100%æ´»ç”¨
impl OrganizationHierarchyService {
    // æ–°è¦Repositoryä½œæˆç¦æ­¢ãƒ»æ—¢å­˜æ´»ç”¨å¿…é ˆ
    org_dept_repo: OrganizationDepartmentRepository,  // æ—¢å­˜
    permission_repo: PermissionMatrixRepository,      // æ—¢å­˜
}
```

**æˆ¦ç•¥3: Phase 2.2ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨**
- Serviceãƒ»Handlerå±¤ã®ã¿æ–°è¦å®Ÿè£…
- æ—¢å­˜Domainãƒ»Repositoryå±¤ã®å®Œå…¨æ´»ç”¨
- HTTPãƒ†ã‚¹ãƒˆä¸­å¿ƒã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

---

## ğŸ” **çµ±ä¸€æ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹è¨­è¨ˆè©³ç´°**

### **æ¨©é™ç¶™æ‰¿ãƒã‚§ãƒ¼ãƒ³ã®ä»•çµ„ã¿**

#### **éšå±¤çš„æ¨©é™ç¶™æ‰¿**

```
çµ„ç¹”ãƒ¬ãƒ™ãƒ«æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
    â†“ ç¶™æ‰¿ + ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
éƒ¨é–€ãƒ¬ãƒ™ãƒ«æ¨©é™è¨­å®š
    â†“ ç¶™æ‰¿ + ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
ãƒãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
    â†“ ç¶™æ‰¿ + å€‹äººãƒ­ãƒ¼ãƒ«é©ç”¨
å€‹äººå®ŸåŠ¹æ¨©é™ï¼ˆæœ€çµ‚é©ç”¨ï¼‰
```

#### **çµ„ç¹”çµ±ä¸€ã‚¬ãƒãƒŠãƒ³ã‚¹ vs ãƒãƒ¼ãƒ å€‹åˆ¥åˆ¶å¾¡**

**çµ„ç¹”ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ¨å¥¨ï¼‰**:

- `PUT /organizations/{id}/permission-matrix` ã§çµ„ç¹”å…¨ä½“ã®çµ±ä¸€ãƒ«ãƒ¼ãƒ«è¨­å®š
- é…ä¸‹å…¨ãƒãƒ¼ãƒ ãƒ»å…¨éƒ¨é–€ãƒ»å…¨ãƒ¡ãƒ³ãƒãƒ¼ã«è‡ªå‹•é©ç”¨
- ä¸€å…ƒç®¡ç†ã«ã‚ˆã‚‹åŠ¹ç‡æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç¢ºä¿
- ä¾‹å¤–è¨­å®šã¯éƒ¨é–€ãƒ»ãƒãƒ¼ãƒ å˜ä½ã§å€‹åˆ¥ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å¯èƒ½

**ãƒãƒ¼ãƒ å€‹åˆ¥åˆ¶å¾¡**:

- `PUT /teams/{id}/permission-matrix` ã§ãƒãƒ¼ãƒ å›ºæœ‰ã®è©³ç´°ãƒ«ãƒ¼ãƒ«è¨­å®š
- å°è¦æ¨¡çµ„ç¹”ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ãƒ»ç‰¹æ®Šè¦ä»¶ã§ã®æŸ”è»Ÿãªæ¨©é™åˆ¶å¾¡
- çµ„ç¹”æ¨©é™ã‚’ç¶™æ‰¿ã—ã¤ã¤ã€ãƒãƒ¼ãƒ ç‰¹æœ‰ã®åˆ¶é™ãƒ»æ‹¡å¼µã‚’è¿½åŠ 

### **å®ŸåŠ¹æ¨©é™åˆ†æ API**

#### **çµ„ç¹”å®ŸåŠ¹æ¨©é™åˆ†æ**

```json
GET /organizations/{id}/effective-permissions?user_id={user_id}

Response:
{
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "organization_id": "org123",
  "inheritance_chain": [
    {
      "level": "organization",
      "source": "organization_matrix",
      "applied_rules": ["admin_access", "export_allowed"]
    },
    {
      "level": "department",
      "source": "dept_engineering",
      "applied_rules": ["code_review_required"],
      "overrides": ["export_limited_to_team"]
    },
    {
      "level": "team",
      "source": "team_backend",
      "applied_rules": ["deploy_permission"],
      "exceptions": ["weekend_deploy_blocked"]
    },
    {
      "level": "user_role",
      "source": "member_role",
      "applied_rules": ["basic_access"]
    }
  ],
  "final_permissions": {
    "tasks": {
      "create": true,
      "read": "team_scope",
      "update": true,
      "delete": false,
      "admin": false
    },
    "analytics": {
      "view_basic": true,
      "export": "team_only",
      "view_advanced": false
    }
  },
  "restrictions": [
    {
      "resource": "deployment",
      "condition": "weekend_blocked",
      "source": "team_backend"
    }
  ]
}
```

#### **æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å–å¾— API**

```json
GET /organizations/{id}/permission-matrix

Response:
{
  "organization_id": "org123",
  "matrix_version": "v2.1",
  "last_updated": "2025-01-22T10:30:00Z",
  "updated_by": "admin@company.com",
  "inheritance_settings": {
    "allow_team_overrides": true,
    "allow_department_exceptions": true,
    "strict_security_policies": true
  },
  "permission_matrix": {
    "tasks": {
      "create": {
        "scope": "team",
        "conditions": ["subscription_level:pro"],
        "quota": {"max_items": 1000},
        "inheritance": "allow_override"
      },
      "admin": {
        "scope": "organization",
        "conditions": ["role:admin", "mfa_enabled"],
        "inheritance": "strict_no_override"
      }
    },
    "analytics": {
      "view_advanced": {
        "scope": "organization",
        "conditions": ["subscription_level:enterprise"],
        "inheritance": "allow_department_override"
      }
    }
  },
  "department_overrides": [
    {
      "department_id": "dept_sales",
      "resource": "analytics",
      "action": "view_customer_data",
      "override_reason": "Sales team specific requirement"
    }
  ],
  "compliance_settings": {
    "audit_log_retention": "7_years",
    "require_justification": true,
    "auto_revoke_inactive": "90_days"
  }
}
```

### **ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**

#### **çµ„ç¹”çµ±ä¸€ã‚¬ãƒãƒŠãƒ³ã‚¹ï¼ˆæ¨å¥¨ï¼‰**

**é©ç”¨ã‚±ãƒ¼ã‚¹**:

- ä¸­ã€œå¤§è¦æ¨¡çµ„ç¹”ï¼ˆ50 åä»¥ä¸Šï¼‰
- ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ãŒå³ã—ã„æ¥­ç•Œ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®çµ±ä¸€ãŒå¿…è¦
- ç›£æŸ»ãƒ»ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¦ä»¶ãŒã‚ã‚‹

**ãƒ¡ãƒªãƒƒãƒˆ**:

- ä¸€å…ƒç®¡ç†ã«ã‚ˆã‚‹é‹ç”¨åŠ¹ç‡å‘ä¸Š
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ç¢ºå®Ÿãªé©ç”¨
- ç›£æŸ»è¨¼è·¡ã®çµ±ä¸€ç®¡ç†
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¬ãƒãƒŠãƒ³ã‚¹

#### **ãƒãƒ¼ãƒ å€‹åˆ¥åˆ¶å¾¡**

**é©ç”¨ã‚±ãƒ¼ã‚¹**:

- å°è¦æ¨¡çµ„ç¹”ãƒ»ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã®ç‹¬ç«‹æ€§ãŒé‡è¦
- éƒ¨é–€é–“ã§æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹ãŒå¤§ããç•°ãªã‚‹
- ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«ãªæ¨©é™å¤‰æ›´ãŒå¿…è¦

**ãƒ¡ãƒªãƒƒãƒˆ**:

- æŸ”è»Ÿãªæ¨©é™ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- ãƒãƒ¼ãƒ ã®è‡ªå¾‹æ€§ç¢ºä¿
- è¿…é€Ÿãªæ¨©é™å¤‰æ›´å¯¾å¿œ
- ç‰¹æ®Šè¦ä»¶ã¸ã®å¯¾å¿œåŠ›

**å®Ÿè£…ã«ã‚ˆã‚Šã€æ—¢å­˜ã®å‹•çš„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«æ‹¡å¼µã—ã€çµ„ç¹”ã®æˆé•·æ®µéšãƒ»æ¥­ç•Œè¦ä»¶ãƒ»é‹ç”¨æ–¹é‡ã«å¿œã˜ãŸæœ€é©ãªæ¨©é™ã‚¬ãƒãƒŠãƒ³ã‚¹ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚**
