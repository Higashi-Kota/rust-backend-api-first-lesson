# Rust Backend API - Feature-based Architecture

## ğŸ“Œ ç¾åœ¨ã®çŠ¶æ…‹ (2025-07-11)

**Phase 19 å®Œäº†** - å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹é”æˆ âœ…
- ãƒ“ãƒ«ãƒ‰æˆåŠŸ: ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šãªã—
- Clippy: å…¨è­¦å‘Šè§£æ¶ˆ
- ãƒ†ã‚¹ãƒˆ: 523/523 ãƒ‘ã‚¹ (6 ignored)
- CI: `make ci-check-fast` æˆåŠŸ

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ç¾åœ¨ã®æ§‹é€ 
```
src/
â”œâ”€â”€ features/          # æ©Ÿèƒ½åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (Phase 14-18ã§å®Ÿè£…)
â”‚   â”œâ”€â”€ auth/         # èªè¨¼ãƒ»èªå¯
â”‚   â”œâ”€â”€ task/         # ã‚¿ã‚¹ã‚¯ç®¡ç†
â”‚   â”œâ”€â”€ team/         # ãƒãƒ¼ãƒ ç®¡ç†
â”‚   â”œâ”€â”€ organization/ # çµ„ç¹”ç®¡ç†
â”‚   â”œâ”€â”€ storage/      # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ gdpr/         # GDPRå¯¾å¿œ
â”‚   â”œâ”€â”€ security/     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ admin/        # ç®¡ç†è€…æ©Ÿèƒ½
â”‚   â”œâ”€â”€ analytics/    # åˆ†ææ©Ÿèƒ½
â”‚   â””â”€â”€ subscription/ # ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
â”œâ”€â”€ api/              # ãƒ¬ã‚¬ã‚·ãƒ¼APIå±¤ï¼ˆæ®µéšçš„ã«å‰Šé™¤äºˆå®šï¼‰
â”œâ”€â”€ domain/           # ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆæ®µéšçš„ã«å‰Šé™¤äºˆå®šï¼‰
â”œâ”€â”€ repository/       # ãƒ¬ã‚¬ã‚·ãƒ¼ãƒªãƒã‚¸ãƒˆãƒªå±¤ï¼ˆæ®µéšçš„ã«å‰Šé™¤äºˆå®šï¼‰
â”œâ”€â”€ service/          # ãƒ¬ã‚¬ã‚·ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆæ®µéšçš„ã«å‰Šé™¤äºˆå®šï¼‰
â”œâ”€â”€ shared/           # å…±é€šå‹ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ infrastructure/   # æŠ€è¡“åŸºç›¤
â””â”€â”€ main.rs
```

### Feature ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¨™æº–æ§‹é€ 
```
features/{feature_name}/
â”œâ”€â”€ mod.rs           # å…¬é–‹APIå®šç¾©
â”œâ”€â”€ handlers/        # HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”œâ”€â”€ services/        # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ repositories/    # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
â”œâ”€â”€ models/          # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ dto/             # ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ requests/    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
â”‚   â””â”€â”€ responses/   # ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
â””â”€â”€ usecases/        # è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

## ğŸ“‹ æ®‹ã‚¿ã‚¹ã‚¯ä¸€è¦§

### Phase 20: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å®Œå…¨å‰Šé™¤
**ç›®çš„**: å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã‚ˆã‚‹æš«å®šå¯¾å¿œã‚’è§£æ¶ˆã—ã€å…¨ã‚³ãƒ¼ãƒ‰ã‚’é©åˆ‡ãªå ´æ‰€ã«é…ç½®

#### å‰Šé™¤å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
```
# ç©ºã®å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
api/handlers/analytics_handler.rs
api/handlers/organization_handler.rs
api/handlers/security_handler.rs
api/handlers/subscription_handler.rs

# ç§»è¡ŒãŒå¿…è¦ãªDTO
api/dto/admin_organization_dto.rs
api/dto/admin_role_dto.rs
api/dto/analytics_dto.rs
api/dto/organization_hierarchy_dto.rs
api/dto/subscription_history_dto.rs
api/dto/team_dto.rs

# ç§»è¡ŒãŒå¿…è¦ãªãƒ¢ãƒ‡ãƒ«
domain/stripe_subscription_model.rs
domain/subscription_history_model.rs

# ç§»è¡ŒãŒå¿…è¦ãªãƒªãƒã‚¸ãƒˆãƒª
repository/stripe_subscription_repository.rs
repository/subscription_history_repository.rs

# ç§»è¡ŒãŒå¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹
service/subscription_service.rs
```

### Phase 21: æœªç§»è¡Œæ©Ÿèƒ½ã®FeatureåŒ–
**ç›®çš„**: æ®‹ã‚Šã®æ©Ÿèƒ½ã‚’ç‹¬ç«‹ã—ãŸfeatureãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…

#### æ–°è¦Featureä½œæˆ
1. **features/payment/**
   - `api/handlers/payment_handler.rs` â†’ `features/payment/handlers/`
   - `service/payment_service.rs` â†’ `features/payment/services/`
   - Stripeçµ±åˆãƒ­ã‚¸ãƒƒã‚¯ã®æ•´ç†

2. **features/user/**
   - `api/handlers/user_handler.rs` â†’ `features/user/handlers/`
   - `service/user_service.rs` â†’ `features/user/services/`
   - authã‹ã‚‰ç‹¬ç«‹ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½

3. **features/system/**
   - `api/handlers/system_handler.rs` â†’ `features/system/handlers/`
   - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç­‰ã®ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½

### Phase 22: å“è³ªæ”¹å–„
**ç›®çš„**: ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å‘ä¸Š

#### ã‚¿ã‚¹ã‚¯
1. **Ignoredãƒ†ã‚¹ãƒˆã®ä¿®æ­£** (6ä»¶)
   - Admin settingså‰Šé™¤ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…
   - Feature usage trackingæ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…

2. **Dead Codeå‰Šé™¤** (ç´„70ç®‡æ‰€)
   - `#[allow(dead_code)]` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®é™¤å»
   - æœªä½¿ç”¨é–¢æ•°ãƒ»æ§‹é€ ä½“ã®å‰Šé™¤

3. **DTOã®ä¸€è²«æ€§ç¢ºä¿**
   - å…¨featureã§requests/responsesæ§‹é€ ã‚’çµ±ä¸€
   - ã‚°ãƒ­ãƒ–ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤‰æ›´

### Phase 23: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æº–å‚™
**ç›®çš„**: ãƒãƒ«ãƒã‚¯ãƒ¬ãƒ¼ãƒˆæ§‹æˆã¸ã®ç§»è¡Œæº–å‚™

#### æœ€çµ‚æ§‹é€ æ¡ˆ
```
rust-backend-api/
â”œâ”€â”€ Cargo.toml          # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ shared/         # å…±é€šå‹ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ core/           # ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³
â”‚   â”œâ”€â”€ infrastructure/ # æŠ€è¡“åŸºç›¤
â”‚   â”œâ”€â”€ feature-auth/   # èªè¨¼æ©Ÿèƒ½
â”‚   â”œâ”€â”€ feature-task/   # ã‚¿ã‚¹ã‚¯ç®¡ç†
â”‚   â”œâ”€â”€ feature-team/   # ãƒãƒ¼ãƒ ç®¡ç†
â”‚   â”œâ”€â”€ feature-org/    # çµ„ç¹”ç®¡ç†
â”‚   â””â”€â”€ ...            # ä»–ã®featureã‚¯ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ apps/
    â”œâ”€â”€ api-server/     # ãƒ¡ã‚¤ãƒ³APIã‚µãƒ¼ãƒãƒ¼
    â””â”€â”€ worker/         # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼
```

## ğŸ“š è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è¨­è¨ˆåŸå‰‡ã€å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€å„Phaseã®è©³ç´°ãªå®Ÿè£…æ‰‹é †ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- **[è¨­è¨ˆåŸå‰‡ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](./CLAUDE-GUIDELINES.md)**
  - å‘½åè¦å‰‡ã®çµ±ä¸€
  - Services vs UseCases: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®é…ç½®æŒ‡é‡
  - å¾ªç’°ä¾å­˜ã‚’é˜²ããŸã‚ã®è¨­è¨ˆåŸå‰‡
  - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®ãƒªã‚¹ã‚¯è»½æ¸›æ–¹é‡
  - è­¦å‘ŠæŠ‘åˆ¶ã®é‹ç”¨ãƒ«ãƒ¼ãƒ«

- **[Phaseå®Ÿè£…è©³ç´°](./CLAUDE-PHASES.md)**
  - Phase 20-23ã®è©³ç´°ãªå®Ÿè£…æ‰‹é †
  - å„Phaseã®å®Œäº†æ¡ä»¶ã¨æˆåŠŸæŒ‡æ¨™
  - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨ãƒªã‚¹ã‚¯ç®¡ç†
  - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹æˆã¸ã®ç§»è¡Œæº–å‚™

## ğŸ¯ è¨­è¨ˆåŸå‰‡ã‚µãƒãƒªãƒ¼

### ä¾å­˜é–¢ä¿‚ã®åŸå‰‡
```
handler â†’ service â†’ repository â†’ domain
   â†“         â†“          â†“          â†“
  dto    usecase      dto       (core)
```
- ä¸Šä½å±¤ã¯ä¸‹ä½å±¤ã®ã¿ã«ä¾å­˜
- å¾ªç’°ä¾å­˜ã¯çµ¶å¯¾ã«é¿ã‘ã‚‹
- æ¨ªæ–­çš„é–¢å¿ƒäº‹ã¯sharedãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é…ç½®

è©³ç´°ã¯[CLAUDE-GUIDELINES.md](./CLAUDE-GUIDELINES.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å³åº§ã«å®Ÿè¡Œå¯èƒ½ãªã‚¿ã‚¹ã‚¯
1. ãƒ¬ã‚¬ã‚·ãƒ¼DTOãƒ•ã‚¡ã‚¤ãƒ«ã®ç§»è¡Œï¼ˆæ©Ÿæ¢°çš„ä½œæ¥­ï¼‰
2. ç©ºã®å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã®ä¸€æ‹¬æ›´æ–°

### æ¤œè¨ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯
1. Paymentæ©Ÿèƒ½ã®è¨­è¨ˆã¨FeatureåŒ–
2. Useræ©Ÿèƒ½ã®authæ©Ÿèƒ½ã‹ã‚‰ã®åˆ†é›¢æ–¹æ³•
3. ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹æˆã¸ã®ç§»è¡Œæˆ¦ç•¥

### æˆåŠŸæŒ‡æ¨™
- [ ] `api/`, `domain/`, `repository/`, `service/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç©º
- [ ] å…¨æ©Ÿèƒ½ãŒfeaturesãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é…ä¸‹ã«å­˜åœ¨
- [ ] `#[allow(dead_code)]` ãŒ0ä»¶
- [ ] ignoredãƒ†ã‚¹ãƒˆãŒ0ä»¶
- [ ] å„featureãŒç‹¬ç«‹ã—ã¦ãƒ“ãƒ«ãƒ‰å¯èƒ½ï¼ˆå°†æ¥ï¼‰

## ğŸ“ å‚™è€ƒ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç”ŸããŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²è¡Œã«åˆã‚ã›ã¦æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
å„Phaseã®å®Œäº†æ™‚ã«ã¯ã€å®Œäº†æ—¥ã¨ä¸»ãªæˆæœã‚’è¨˜éŒ²ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---
æœ€çµ‚æ›´æ–°: 2025-07-11
Phase 19å®Œäº†ã€å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹é”æˆ