## ğŸ§© å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 1. **ãƒ‰ãƒ¡ã‚¤ãƒ³çµ±åˆã®åŸå‰‡**

* **æ—¢å­˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã®é‡è¤‡ãƒ»ç«¶åˆã¯ç¦æ­¢**
  * åŒã˜æ„å‘³ã®åˆ¥è¡¨ç¾ã€ä¼¼ãŸãŒç•°ãªã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¢—åŠ ã¯é¿ã‘ã‚‹
  * APIã®ã‚¹ãƒ©ã‚°ãªã©æ©Ÿèƒ½åˆ¥ã®çµ±ä¸€æ„Ÿã‚’æ„è­˜
  * APIã®ã‚¹ãƒ©ã‚°ãªã©ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®é‡è¤‡æ’é™¤ï¼†é›†ç´„çµ±åˆã‚’æ„è­˜
* **ã€Œäºœç¨®ã€APIãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³å®šç¾©ã®å¢—åŠ ã¯é¿ã‘ã‚‹**
  * æ–°è¦å®šç¾©ãŒå¿…è¦ãªå ´åˆã¯ã€**æ—¢å­˜ã®è²¬å‹™ãƒ»å¢ƒç•Œã«çµ±åˆ**ã§ãã‚‹ã‹å†æ¤œè¨

### 2. **dead\_code ãƒãƒªã‚·ãƒ¼**

* `#![allow(dead_code)]` ã‚„ `#[allow(dead_code)]` ã®**æ–°è¦è¿½åŠ ã¯ç¦æ­¢**
* **æ—¢å­˜ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰APIã¨ã—ã¦ä¾¡å€¤æä¾›ã§ãã‚‹å ´åˆã¯ç©æ¥µçš„ã«å¤–ã™**
  * æ–°è¦APIã«ã¯çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
    ```rust
    // å¿…é ˆ: 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    #[tokio::test]
    async fn test_feature_success() { /* æ­£å¸¸ç³» */ }

    #[tokio::test]
    async fn test_feature_invalid_data() { /* ç•°å¸¸ç³» */ }

    #[tokio::test]
    async fn test_feature_forbidden() { /* æ¨©é™ã‚¨ãƒ©ãƒ¼ */ }
    ```
  * å¿…è¦ã«å¿œã˜ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹DBè¨­è¨ˆã‚‚è€ƒæ…®
* **æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ãƒ»ã‚·ã‚°ãƒãƒãƒ£ãƒ»æ§‹é€ ä½“ã¯å‰Šé™¤**
  * ãŸã ã—ã€ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€å®Ÿè£…ã§é©åˆ‡ã«æ´»ç”¨ã™ã‚‹

### 3. **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å“è³ªåŸºæº–**

* **ã™ã¹ã¦ã®å…¬é–‹APIã¯å®Ÿè£…ã§ä½¿ç”¨ã•ã‚Œã‚‹**ã“ã¨
* **ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ã®å‹•ä½œã‚’æ¤œè¨¼**ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨
* **æœªä½¿ç”¨ã®è­¦å‘ŠãŒå‡ºãªã„ã“ã¨**ï¼ˆdead_codeè­¦å‘Šã‚’å«ã‚€ï¼‰

### 4. **CIãƒ»Lint è¦ä»¶**

* ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ **ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘ŠãŒå®Œå…¨ã«ã‚¼ãƒ­** ã§ã‚ã‚‹ã“ã¨ï¼š

  ```bash
  cargo clippy --all-targets --all-features -- -D warnings
  ```

* æ—¢å­˜CIï¼ˆãƒ†ã‚¹ãƒˆï¼‰ã‚³ãƒãƒ³ãƒ‰ï¼š

  ```bash
  make ci-check
  ```

  â†’ **ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã«ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ï¼ˆæ–°æ—§å«ã‚€ï¼‰**

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ä»¶

### å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testï¼‰

* **æ–°è¦ãƒ­ã‚¸ãƒƒã‚¯ã«å¯¾ã™ã‚‹ç´°ç²’åº¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…**

  * æ¡ä»¶åˆ†å²ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãªã©ã‚’ç¶²ç¾…
  * æ¦‚å¿µãƒ†ã‚¹ãƒˆãƒ»å‹ã ã‘ã®ãƒ†ã‚¹ãƒˆã¯ä¸å¯

### çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰

* APIãƒ¬ãƒ™ãƒ«ã§ã®**E2Eãƒ•ãƒ­ãƒ¼ç¢ºèª**

  * ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã®å¦¥å½“æ€§
  * DBæ›¸ãè¾¼ã¿ãƒ»èª­ã¿å‡ºã—ã®æ•´åˆæ€§
  * ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¤œè¨¼

---

## ğŸ”¥ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ–¹é‡

* **ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰**ã®å–ã‚Šæ‰±ã„ï¼š
  1. **ãƒ†ã‚¹ãƒˆã§ã®ã¿ä½¿ç”¨** â†’ å®Ÿè£…ã§æ´»ç”¨ã™ã‚‹ã‚ˆã†çµ±åˆ
  2. **ã©ã“ã§ã‚‚æœªä½¿ç”¨** â†’ å‰Šé™¤
  3. **å°†æ¥ã®æ‹¡å¼µç”¨** â†’ ç¾æ™‚ç‚¹ã§ä¾¡å€¤æä¾›ã§ãã‚‹ã‚ˆã†å®Ÿè£…

* dead\_code ã§æ¤œçŸ¥ã•ã‚Œã‚‹è¦ç´ ã¸ã®å¯¾å¿œï¼š
  * **å…¬é–‹APIï¼ˆpubï¼‰** â†’ å®Ÿè£…ã§ã®æ´»ç”¨ã‚’æ¤œè¨
  * **å†…éƒ¨å®Ÿè£…ï¼ˆépubï¼‰** â†’ ä½¿ç”¨ã•ã‚Œã¦ã„ãªã‘ã‚Œã°å‰Šé™¤
  * **ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** â†’ ãã®ã¾ã¾ç¶­æŒ

---

## ğŸš€ å®Ÿè£…å®Œäº†å¾Œã®æœŸå¾…ã•ã‚Œã‚‹çŠ¶æ…‹

1. **`cargo clippy`ã§è­¦å‘Šã‚¼ãƒ­**ï¼ˆdead_codeè­¦å‘Šã‚’å«ã‚€ï¼‰
2. **`make ci-check`ã§ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒã‚°ãƒªãƒ¼ãƒ³**
3. **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…ãŒä¸€è‡´**
4. **ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã®å®Ÿéš›ã®å‹•ä½œã‚’æ¤œè¨¼**
5. **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒ¼ãƒ³ã§ä¿å®ˆã—ã‚„ã™ã„**

---

## ğŸ“Š æœ€çµ‚dead_codeè§£æ¶ˆè¨­è¨ˆï¼ˆ2025-01-02ï¼‰

### ç¾åœ¨ã®çŠ¶æ³åˆ†æ

#### æ®‹å­˜dead_codeï¼ˆ7å€‹ï¼‰ã®å†…è¨³

1. **ãƒ†ã‚¹ãƒˆå°‚ç”¨ï¼ˆ4å€‹ï¼‰** - ãã®ã¾ã¾ç¶­æŒ
   - `AppConfig::for_testing()` (config.rs:199)
   - `RefreshTokenRepository::with_schema()` (refresh_token_repository.rs:24)
   - `UserRepository::with_schema()` (user_repository.rs:24)
   - `PasswordResetTokenRepository::with_schema()` (password_reset_token_repository.rs:24)

2. **æœªä½¿ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ2å€‹ï¼‰** - è©³ç´°åˆ†æçµæœ
   - `UserClaims::is_member()` (user_model.rs:227)
   - `UserRepository::find_all_with_roles()` (user_repository.rs:287)

3. **çµ„ç¹”ãƒ¢ãƒ‡ãƒ«ï¼ˆ1å€‹ï¼‰** - è©³ç´°åˆ†æçµæœ
   - `Organization` implå…¨ä½“ (organization_model.rs:67)

---

### ğŸ” è©³ç´°åˆ†æã¨æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### 1. `UserClaims::is_member()` ã®åˆ†æ

**å®Ÿè£…å†…å®¹**:
```rust
pub fn is_member(&self) -> bool {
    if let Some(ref role) = self.role {
        PermissionChecker::is_member(role)
    } else {
        PermissionChecker::check_permission_by_role_name(
            &self.role_name,
            PermissionType::IsMember,
            None,
        )
    }
}
```

**åˆ†æçµæœ**:
- `is_admin()`ãƒ¡ã‚½ãƒƒãƒ‰ã®å¯¾ã¨ãªã‚‹å®Ÿè£…
- æ¨©é™ãƒã‚§ãƒƒã‚¯ã®ä¸€è²«æ€§ã®ãŸã‚ã«å¿…è¦
- `PermissionChecker`ã¸ã®å˜ãªã‚‹å§”è­²ã§ã¯ãªãã€Claimså†…ã®ãƒ­ãƒ¼ãƒ«æƒ…å ±ã‚’æ´»ç”¨

**æ¨å¥¨**: **ç¶­æŒã—ã¦æ´»ç”¨**
- æ¨©é™ãƒã‚§ãƒƒã‚¯APIã§`is_member`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦å…¬é–‹
- ä¾‹: `GET /permissions/check`ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹

#### 2. `UserRepository::find_all_with_roles()` ã®åˆ†æ

**å®Ÿè£…å†…å®¹**:
```rust
pub async fn find_all_with_roles(&self) -> Result<Vec<SafeUserWithRole>, DbErr> {
    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã§å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    let results = UserEntity::find()
        .join(JoinType::InnerJoin, user_model::Relation::Role.def())
        .select_also(RoleEntity)
        .order_by(user_model::Column::CreatedAt, Order::Desc)
        .all(&self.db)
        .await?;
    // ...
}
```

**åˆ†æçµæœ**:
- `find_all_with_roles_paginated()`ãŒå­˜åœ¨ã—ã€åŒã˜æ©Ÿèƒ½ã‚’æä¾›
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã®å…¨ä»¶å–å¾—ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒªã‚¹ã‚¯
- ç‰¹åˆ¥ãªç”¨é€”ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç­‰ï¼‰ä»¥å¤–ã§ã¯ä¸è¦

**æ¨å¥¨**: **å‰Šé™¤**
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆã§ååˆ†
- å…¨ä»¶å¿…è¦ãªå ´åˆã¯é«˜ã„page_sizeã‚’æŒ‡å®š

#### 3. `Organization` implãƒ–ãƒ­ãƒƒã‚¯ã®åˆ†æ

**å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§**:
```rust
impl Organization {
    - get_subscription_tier()     // éšå±¤æƒ…å ±ã®å–å¾—
    - get_settings()             // è¨­å®šJSONã®ãƒ‘ãƒ¼ã‚¹
    - update_settings()          // è¨­å®šã®æ›´æ–°
    - update_subscription_tier() // éšå±¤ã¨åˆ¶é™ã®æ›´æ–°
    - can_add_teams()           // ãƒãƒ¼ãƒ è¿½åŠ å¯å¦ãƒã‚§ãƒƒã‚¯
    - can_add_members()         // ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ å¯å¦ãƒã‚§ãƒƒã‚¯
    - update_name()             // åå‰ã®æ›´æ–°
    - update_description()      // èª¬æ˜ã®æ›´æ–°
    - to_organization()         // SeaORMâ†’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å¤‰æ›
    - from_organization()       // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«â†’SeaORMå¤‰æ›
}
```

**åˆ†æçµæœ**:
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€é‡è¦ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³éšå±¤ã«ã‚ˆã‚‹åˆ¶é™ç®¡ç†
- æ—¢ã«DBã‚¹ã‚­ãƒ¼ãƒã¨ã‚µãƒ¼ãƒ“ã‚¹å±¤ãŒå­˜åœ¨

**æ¨å¥¨**: **ç¶­æŒã—ã¦çµ„ç¹”ç®¡ç†APIã§æ´»ç”¨**
- çµ„ç¹”ã®å®¹é‡ç®¡ç†APIï¼ˆ`can_add_teams`, `can_add_members`ï¼‰
- çµ„ç¹”è¨­å®šç®¡ç†APIï¼ˆ`update_settings`ï¼‰
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã®çµ±åˆ

---

### ğŸ¯ å®Ÿè£…è¨ˆç”»

#### çŸ­æœŸå¯¾å¿œï¼ˆ1å€‹å‰Šæ¸›ï¼‰
1. **`UserRepository::find_all_with_roles()`ã‚’å‰Šé™¤**
   - ä½¿ç”¨ç®‡æ‰€ãªã—ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç‰ˆã§ä»£æ›¿å¯èƒ½
   - **çµæœ**: dead_code 7å€‹ â†’ 6å€‹

#### ä¸­æœŸå¯¾å¿œï¼ˆ2å€‹æ´»ç”¨ï¼‰
2. **`UserClaims::is_member()`ã‚’æ¨©é™ãƒã‚§ãƒƒã‚¯APIã§æ´»ç”¨**
   ```yaml
   # æ—¢å­˜ã® GET /permissions/check ã‚’æ‹¡å¼µ
   response:
     allowed: boolean
     is_admin: boolean
     is_member: boolean  # è¿½åŠ 
     permissions: array
   ```

3. **Organization implã‚’çµ„ç¹”ç®¡ç†APIã§æ´»ç”¨**
   ```yaml
   # æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   GET /organizations/{id}/capacity
     response:
       can_add_teams: boolean
       can_add_members: boolean
       current_teams: number
       max_teams: number
       current_members: number
       max_members: number
   
   PATCH /organizations/{id}/settings
     request:
       settings: object
   ```

---

### âœ… æœ€çµ‚çŠ¶æ…‹ã®è¨­è¨ˆ

#### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆdead_code: 4å€‹ï¼‰
1. ãƒ†ã‚¹ãƒˆå°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ4å€‹ï¼‰ - `#[allow(dead_code)]`ã®ã¾ã¾ç¶­æŒ
   - ç†ç”±: ãƒ†ã‚¹ãƒˆã§ã®ã¿ä½¿ç”¨ã€`#[cfg(test)]`ã¸ã®å¤‰æ›´ã¯ä»»æ„

#### æ´»ç”¨ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰
1. `UserClaims::is_member()` - æ¨©é™ãƒã‚§ãƒƒã‚¯APIã§ä½¿ç”¨
2. `Organization` impl - çµ„ç¹”ç®¡ç†APIã§ä½¿ç”¨

#### å‰Šé™¤ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰
1. `UserRepository::find_all_with_roles()` - ä¸è¦

### ğŸ“ˆ åŠ¹æœ
- dead_codeã®æ˜ç¢ºãªç†ç”±ä»˜ã‘
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®é©åˆ‡ãªæ´»ç”¨
- APIã®æ©Ÿèƒ½æ‹¡å¼µ
