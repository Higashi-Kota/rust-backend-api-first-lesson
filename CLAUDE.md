## å®Ÿç¾ãƒˆãƒ”ãƒƒã‚¯

### ã‚¯ãƒ¬ãƒ¼ãƒˆåˆ†å‰²ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰æ™‚é–“æœ€é©åŒ–

**äº‹å‰æº–å‚™**: ã‚¯ãƒ¬ãƒ¼ãƒˆåˆ†å‰²ã‚’å®Ÿæ–½ã™ã‚‹å‰ã«ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã®ä¾å­˜é–¢ä¿‚æ•´ç†ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚è©³ç´°ãªæ‰‹é †ã¯[a.md](./a.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### èƒŒæ™¯ã¨ç›®çš„
- **èª²é¡Œ**: ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ãªæ§‹é€ ã«ã‚ˆã‚Šã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«å…¨ä½“ã®å†ãƒ“ãƒ«ãƒ‰ãŒç™ºç”Ÿã—ã€é–‹ç™ºåŠ¹ç‡ãŒä½ä¸‹
- **ç›®çš„**: å¤‰æ›´é »åº¦ã«åŸºã¥ã„ãŸã‚¯ãƒ¬ãƒ¼ãƒˆåˆ†å‰²ã«ã‚ˆã‚Šã€ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®ã—é–‹ç™ºç”Ÿç”£æ€§ã‚’å‘ä¸Š

## ğŸ§© å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 1. **ãƒ‰ãƒ¡ã‚¤ãƒ³çµ±åˆã®åŸå‰‡**

* **æ—¢å­˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã®é‡è¤‡ãƒ»ç«¶åˆã¯ç¦æ­¢**
  * åŒã˜æ„å‘³ã®åˆ¥è¡¨ç¾ã€ä¼¼ãŸãŒç•°ãªã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¢—åŠ ã¯é¿ã‘ã‚‹
  * APIã®ã‚¹ãƒ©ã‚°ãªã©æ©Ÿèƒ½åˆ¥ã®çµ±ä¸€æ„Ÿã‚’æ„è­˜
  * ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ `{param}` å½¢å¼ã‚’ä½¿ç”¨ï¼ˆAxum 0.8ã®ä»•æ§˜ï¼‰
  * APIã®ã‚¹ãƒ©ã‚°ãªã©ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®é‡è¤‡æ’é™¤ï¼†é›†ç´„çµ±åˆã‚’æ„è­˜
* **ã€Œäºœç¨®ã€APIãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³å®šç¾©ã®å¢—åŠ ã¯é¿ã‘ã‚‹**
  * æ–°è¦å®šç¾©ãŒå¿…è¦ãªå ´åˆã¯ã€**æ—¢å­˜ã®è²¬å‹™ãƒ»å¢ƒç•Œã«çµ±åˆ**ã§ãã‚‹ã‹å†æ¤œè¨

### 2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

#### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å‘½åè¦å‰‡

**å½¢å¼**: `"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å::é–¢æ•°å[:è©³ç´°]"`

```rust
// âœ… æ¨å¥¨ã•ã‚Œã‚‹å‘½åè¦å‰‡
convert_validation_errors(e, "user_handler::update_profile")
convert_validation_errors(e, "auth_handler::signup")
convert_validation_errors(e, "analytics_handler::get_system_stats")

// âŒ é¿ã‘ã‚‹ã¹ãä¾‹
convert_validation_errors(e, "team")  // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ãªã—
convert_validation_errors(e, "validation")  // æ±ç”¨çš„ã™ãã‚‹
```

#### error_helperé–¢æ•°ã®æ´»ç”¨

**ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§error_helperé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**

```rust
use crate::utils::error_helper::{internal_server_error, not_found_error, conflict_error};

// âœ… æ¨å¥¨: error_helperä½¿ç”¨
self.repo.count_tasks()
    .await
    .map_err(|e| internal_server_error(
        e,
        "task_service::get_stats",  // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
        "Failed to count tasks"      // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    ))?;

// âŒ é¿ã‘ã‚‹ã¹ã: ç›´æ¥ã‚¨ãƒ©ãƒ¼ç”Ÿæˆ
.map_err(|e| AppError::InternalServerError(format!("Failed to count: {}", e)))?;
```

#### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ä¸€è²«æ€§

- error_helperé–¢æ•°ã¯è‡ªå‹•çš„ã«æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å‡ºåŠ›
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã«ã‚ˆã‚Šã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€ã®ç‰¹å®šãŒå®¹æ˜“
- æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‡ãƒãƒƒã‚°ãƒ»ç›£è¦–ã«æœ‰åŠ¹

### 3. **æ©Ÿèƒ½è¿½åŠ ã®åŸå‰‡ï¼šå®Ÿç”¨çš„ã§ä¾¡å€¤ã®é«˜ã„æ©Ÿèƒ½ã«é›†ä¸­**

* **æ–°æ©Ÿèƒ½ã®æ¡ç”¨åŸºæº–**
  * **å®Ÿç”¨æ€§**: å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‹ãƒ¼ã‚ºã«åŸºã¥ã„ã¦ã„ã‚‹ã‹
  * **ä¾¡å€¤**: å®Ÿè£…ã‚³ã‚¹ãƒˆã«è¦‹åˆã†ä¾¡å€¤ã‚’æä¾›ã™ã‚‹ã‹
  * **ä¿å®ˆæ€§**: é•·æœŸçš„ãªä¿å®ˆãŒå¯èƒ½ã‹
  * **æ—¢å­˜æ©Ÿèƒ½ã¨ã®æ•´åˆæ€§**: æ—¢å­˜ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨èª¿å’Œã™ã‚‹ã‹

* **æ©Ÿèƒ½ã®å„ªå…ˆé †ä½ä»˜ã‘**
  * **é«˜å„ªå…ˆåº¦**: ç›´æ¥çš„ãªãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å¤§å¹…æ”¹å–„
  * **ä¸­å„ªå…ˆåº¦**: é‹ç”¨åŠ¹ç‡åŒ–ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
  * **ä½å„ªå…ˆåº¦**: Nice to haveã€å°†æ¥çš„ãªæ‹¡å¼µæ€§ã®ã¿

* **å®Ÿè£…ã‚’è¦‹é€ã‚‹åˆ¤æ–­åŸºæº–**
  * ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§åŠ¹ç‡çš„ã«å®Ÿè£…å¯èƒ½ãªæ©Ÿèƒ½
  * æ—¢å­˜ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹/ãƒ„ãƒ¼ãƒ«ã§ä»£æ›¿å¯èƒ½ãªæ©Ÿèƒ½
  * è¤‡é›‘æ€§ã«å¯¾ã—ã¦å¾—ã‚‰ã‚Œã‚‹ä¾¡å€¤ãŒä½ã„æ©Ÿèƒ½
  * åˆ¥ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ç‹¬ç«‹å®Ÿè£…ã—ãŸæ–¹ãŒæŸ”è»Ÿæ€§ãŒé«˜ã„æ©Ÿèƒ½

* **ä¾‹ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®åˆ¤æ–­**
  * âœ… æ¡ç”¨: ç½²åä»˜ãURLï¼ˆã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šï¼‰
  * âœ… æ¡ç”¨: è‡ªå‹•åœ§ç¸®ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆå‰Šæ¸›ã€å®Ÿç”¨çš„ä¾¡å€¤ï¼‰
  * âŒ è¦‹é€ã‚Š: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´å®Ÿè£…ãŒåŠ¹ç‡çš„ï¼‰
  * âŒ è¦‹é€ã‚Š: ã‚¦ã‚¤ãƒ«ã‚¹ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆå°‚ç”¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å®Ÿè£…ã™ã¹ãï¼‰

### 3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®åŸå‰‡**

* **ãƒ†ãƒ¼ãƒ–ãƒ«åã¯å¿…ãšè¤‡æ•°å½¢**
  * `users`, `tasks`, `teams`, `organizations` ãªã©
  * ã‚¸ãƒ£ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚è¤‡æ•°å½¢: `team_members`, `department_members`
* **ã‚«ãƒ©ãƒ åã¯ snake_case**
  * å¤–éƒ¨ã‚­ãƒ¼ã¯ `{å‚ç…§ãƒ†ãƒ¼ãƒ–ãƒ«å˜æ•°å½¢}_id` å½¢å¼: `user_id`, `team_id`
* **æ¨™æº–ã‚«ãƒ©ãƒ **
  * ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã« `id` (UUIDå‹), `created_at`, `updated_at` ã‚’å«ã‚ã‚‹
  * ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯å¿…ãš `TIMESTAMPTZ` å‹ã‚’ä½¿ç”¨
* **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ**
  * å¤–éƒ¨ã‚­ãƒ¼ã€é »ç¹ã«æ¤œç´¢ã•ã‚Œã‚‹é …ç›®ã«ã¯å¿…ãšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
  * è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯é †åºã‚’è€ƒæ…®ã—ã¦è¨­è¨ˆ
* **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡**
  * å½¢å¼: `m{YYYYMMDD}_{é€£ç•ª6æ¡}_{èª¬æ˜}.rs`
  * é€£ç•ªã¯æ—¢å­˜ã®æœ€å¾Œã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¬¡ã®ç•ªå·ã‚’ä½¿ç”¨
  * ä¾‹: æœ€å¾ŒãŒ `m20250704_180001_` ãªã‚‰æ¬¡ã¯ `m20250704_180002_`
  * æ—¥ä»˜ã‚’ã¾ãŸãå ´åˆã¯ `000001` ã‹ã‚‰é–‹å§‹

### 4. **APIæ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€ï¼ˆUnix Timestampï¼‰**

* **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ—¥æ™‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯Unix Timestampï¼ˆç§’å˜ä½ï¼‰ã§çµ±ä¸€**
  * ã™ã¹ã¦ã®æ—¥æ™‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ•°å€¤å‹ï¼ˆi64ï¼‰ã¨ã—ã¦è¿”ã™
  * ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã«ä¾å­˜ã—ãªã„ UTC ãƒ™ãƒ¼ã‚¹ã®çµ¶å¯¾æ™‚åˆ»
  * ä¾‹: `"created_at": 1736922123` ï¼ˆ2025-01-15 05:55:23 UTCï¼‰

* **å®Ÿè£…è©³ç´°**
  * ã‚«ã‚¹ã‚¿ãƒ  `Timestamp` å‹ã«ã‚ˆã‚Šå‹å®‰å…¨æ€§ã‚’ç¢ºä¿
  * DBãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ `DateTime<Utc>` ã®ã¾ã¾å¤‰æ›´ãªã—ï¼ˆ`TIMESTAMPTZ`å‹ï¼‰
  * ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã®ã¿Unix timestampã«å¤‰æ›

* **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**
  ```javascript
  // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›ï¼ˆç§’â†’ãƒŸãƒªç§’ï¼‰
  const createdAt = new Date(response.created_at * 1000);
  
  // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤‰æ›ï¼ˆãƒŸãƒªç§’â†’ç§’ï¼‰
  const payload = {
    due_date: Math.floor(selectedDate.getTime() / 1000)
  };
  
  // ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‡¦ç†
  const completedAt = response.completed_at 
    ? new Date(response.completed_at * 1000) 
    : null;
  ```

* **ãƒ¡ãƒªãƒƒãƒˆ**
  * **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æ•°å€¤ã¯æ–‡å­—åˆ—ã‚ˆã‚Šè»¢é€ã‚µã‚¤ã‚ºãŒå°ã•ãã€ãƒ‘ãƒ¼ã‚¹å‡¦ç†ã‚‚é«˜é€Ÿ
  * **å¤šè¨€èªå¯¾å¿œ**: Unix timestampã¯è¨€èªãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ éä¾å­˜
  * **ä¸€è²«æ€§**: ã™ã¹ã¦ã®APIã§çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  * **æ¥­ç•Œæ¨™æº–**: Twitterã€Stripeç­‰ã®ä¸»è¦APIã§æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹å½¢å¼

#### ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å®Ÿè£…ã®æ­£è¦åŒ–ã«ãŠã‘ã‚‹DBè¨­è¨ˆå¤‰æ›´

* **ç°¡æ˜“å®Ÿè£…ãƒ»ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å®Ÿè£…ã‚’æ­£è¦å®Ÿè£…ã«ç½®ãæ›ãˆã‚‹éš›ã¯ã€å¿…è¦ã«å¿œã˜ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹DBè¨­è¨ˆã®å¤‰æ›´ã‚‚è¡Œã†**
  * ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤ã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨ˆç®—ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
  * åˆ†æã‚„é›†è¨ˆã‚’é«˜é€ŸåŒ–ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚„ã‚µãƒãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
  * æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¸è¶³ã—ã¦ã„ã‚‹ã‚«ãƒ©ãƒ æƒ…å ±ãŒã‚ã‚Œã°è¿½åŠ 

### 5. **dead\_code ãƒãƒªã‚·ãƒ¼**

* `#![allow(dead_code)]` ã‚„ `#[allow(dead_code)]` ã®**æ–°è¦è¿½åŠ ã¯ç¦æ­¢**
* **æ—¢å­˜ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰APIã¨ã—ã¦ä¾¡å€¤æä¾›ã§ãã‚‹å ´åˆã¯ç©æ¥µçš„ã«å¤–ã™**
  * æ–°è¦APIã«ã¯çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
    ```rust
    // å¿…é ˆ: 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ†ã‚¹ãƒˆ
    #[tokio::test]
    async fn test_feature_success() { /* æ­£å¸¸ç³» */ }

    #[tokio::test]
    async fn test_feature_invalid_data() { /* ç•°å¸¸ç³» */ }

    #[tokio::test]
    async fn test_feature_forbidden() { /* æ¨©é™ã‚¨ãƒ©ãƒ¼ */ }
    ```
  * å¿…è¦ã«å¿œã˜ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹DBè¨­è¨ˆã‚‚è€ƒæ…®
* **æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ãƒ»ã‚·ã‚°ãƒãƒãƒ£ãƒ»æ§‹é€ ä½“ã¯å‰Šé™¤**
  * ãŸã ã—ã€ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€å®Ÿè£…ã§é©åˆ‡ã«æ´»ç”¨ã™ã‚‹
* **ä¾‹å¤–: ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°**
  * ãƒ†ã‚¹ãƒˆç”¨ã«ã¤ã„ã¦ã¯ `#[allow(dead_code)]` ã‚’è¨±å¯
    * `AppConfig::for_testing`
    * `TestDatabase::_container`

### 6. **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å“è³ªåŸºæº–**

* **ã™ã¹ã¦ã®å…¬é–‹APIã¯å®Ÿè£…ã§ä½¿ç”¨ã•ã‚Œã‚‹**ã“ã¨
* **ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ã®å‹•ä½œã‚’æ¤œè¨¼**ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨
* **æœªä½¿ç”¨ã®è­¦å‘ŠãŒå‡ºãªã„ã“ã¨**ï¼ˆdead_codeè­¦å‘Šã‚’å«ã‚€ï¼‰

### 7. **APIã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¦å‰‡**

* **ç®¡ç†è€…å°‚ç”¨APIã®åŸå‰‡**
  * ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã€è¨­å®šæƒ…å ±ã€çµ±è¨ˆæƒ…å ±ãªã©ã®ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªæƒ…å ±ã‚’æä¾›ã™ã‚‹APIã¯ **å¿…ãšç®¡ç†è€…å°‚ç”¨** ã«ã™ã‚‹
  * ä¾‹: ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± (`/admin/system/info`)ã€æ±ºæ¸ˆè¨­å®š (`/admin/payments/config`)
  * **ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã¨ãªã‚‹**

* **APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµ±ä¸€è¦å‰‡**
  * **`/api/` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯ä½¿ç”¨ã—ãªã„**
  * å„APIã¯æ©Ÿèƒ½ã«å¿œã˜ãŸé©åˆ‡ãªãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨:
    * `/admin/*` - ç®¡ç†è€…å°‚ç”¨æ©Ÿèƒ½
    * `/auth/*` - èªè¨¼é–¢é€£
    * `/tasks/*` - ã‚¿ã‚¹ã‚¯ç®¡ç†
    * `/teams/*` - ãƒãƒ¼ãƒ ç®¡ç†
    * `/payments/*` - æ±ºæ¸ˆé–¢é€£ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰
    * `/organizations/*` - çµ„ç¹”ç®¡ç†
  * ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ `{param}` å½¢å¼ã‚’ä½¿ç”¨ï¼ˆAxum 0.8ã®ä»•æ§˜ï¼‰

* **èªè¨¼ãƒ»èªå¯ã®è¨­å®š**
  * `skip_auth_paths` - èªè¨¼ä¸è¦ã®ãƒ‘ã‚¹ï¼ˆå…¬é–‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
  * `admin_only_paths` - ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªãƒ‘ã‚¹ï¼ˆ`/admin` ã§çµ±ä¸€ï¼‰
  * æ–°è¦APIã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€é©åˆ‡ãªèªè¨¼ãƒ»èªå¯ãƒ¬ãƒ™ãƒ«ã‚’å¿…ãšè¨­å®šã™ã‚‹

* **CORSè¨­å®š**
  * ç’°å¢ƒå¤‰æ•° `CORS_ALLOWED_ORIGINS` ã§è¨±å¯ã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®šå¯èƒ½
  * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `FRONTEND_URL` ã®å€¤ã‚’ä½¿ç”¨ã€ãã‚Œã‚‚ãªã‘ã‚Œã° `http://localhost:3000`
  * æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšå…·ä½“çš„ãªã‚ªãƒªã‚¸ãƒ³ã‚’æŒ‡å®šã—ã€ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆ`*`ï¼‰ã¯ä½¿ç”¨ã—ãªã„

### 8. **CIãƒ»Lint è¦ä»¶**

* ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ **ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘ŠãŒå®Œå…¨ã«ã‚¼ãƒ­** ã§ã‚ã‚‹ã“ã¨ï¼š

  ```bash
  cargo clippy --all-targets --all-features -- -D warnings
  ```

* æ—¢å­˜CIï¼ˆãƒ†ã‚¹ãƒˆï¼‰ã‚³ãƒãƒ³ãƒ‰ï¼š

  ```bash
  make ci-check-fast
  ```

  â†’ **ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã«ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ï¼ˆæ–°æ—§å«ã‚€ï¼‰**

### 9. **çµ±ä¸€æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ã®ä½¿ç”¨**

#### æ–°è¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ¨©é™è¨­å®š

* **ã™ã¹ã¦ã®æ–°è¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯çµ±ä¸€æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é©ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::require_permission;
  use crate::middleware::authorization::{resources, Action};
  
  .route(
      "/resources/{id}",
      get(handler).route_layer(require_permission!(resources::RESOURCE, Action::View))
  )
  ```

* **ç®¡ç†è€…å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ `admin_permission_middleware()` ã‚’ä½¿ç”¨**
  ```rust
  .route_layer(admin_permission_middleware())
  ```

* **ç›´æ¥çš„ãªæ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆ`is_admin()`ãªã©ï¼‰ã®ä½¿ç”¨ã¯ç¦æ­¢**
  - ã™ã¹ã¦ã®æ¨©é™ãƒã‚§ãƒƒã‚¯ã¯çµ±ä¸€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é€šã˜ã¦å®Ÿæ–½
  - ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã®è¿½åŠ ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ãªå ´åˆã¯ã€æ˜ç¢ºãªç†ç”±ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§è¨˜è¼‰

#### æ¨©é™ãƒã‚§ãƒƒã‚¯ã®éšå±¤

1. **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«**: åŸºæœ¬çš„ãªãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯
2. **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«**: ãƒªã‚½ãƒ¼ã‚¹å›ºæœ‰ã®è©³ç´°ãªæ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆæ‰€æœ‰è€…ç¢ºèªãªã©ï¼‰

#### ãƒ†ã‚¹ãƒˆæ™‚ã®æ¨©é™è€ƒæ…®

* æ¨©é™ãƒ†ã‚¹ãƒˆã¯å¿…ãšä»¥ä¸‹ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚ã‚‹ã“ã¨ï¼š
  - æ­£å¸¸ç³»ï¼ˆæ¨©é™ã‚ã‚Šï¼‰
  - æ¨©é™ãªã—ã‚¨ãƒ©ãƒ¼ï¼ˆ403 Forbiddenï¼‰
  - èªè¨¼ãªã—ã‚¨ãƒ©ãƒ¼ï¼ˆ401 Unauthorizedï¼‰

### 10. **çµ±ä¸€ãƒ­ã‚®ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨**

#### ãƒ­ã‚®ãƒ³ã‚°å®Ÿè£…ã®å¿…é ˆè¦ä»¶

* **ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§log_with_context!ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::log_with_context;
  
  log_with_context!(
      tracing::Level::DEBUG,
      "Creating resource",
      "user_id" => user_id,
      "resource_type" => "task"
  );
  ```

* **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘**
  - `DEBUG`: æ“ä½œé–‹å§‹æ™‚ã€è©³ç´°ãªå‡¦ç†å†…å®¹
  - `INFO`: æ“ä½œæˆåŠŸæ™‚ã€é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆ
  - `WARN`: è­¦å‘Šã™ã¹ãçŠ¶æ³ï¼ˆæ¨©é™ä¸è¶³ã€ãƒªãƒˆãƒ©ã‚¤ãªã©ï¼‰
  - `ERROR`: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã€å‡¦ç†å¤±æ•—

* **3æ®µéšãƒ­ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…**
  ```rust
  // 1. æ“ä½œé–‹å§‹ï¼ˆDEBUGï¼‰
  log_with_context!(
      tracing::Level::DEBUG,
      "Starting operation",
      "user_id" => user_id,
      "operation" => "create_task"
  );
  
  // 2. æ“ä½œæˆåŠŸï¼ˆINFOï¼‰
  log_with_context!(
      tracing::Level::INFO,
      "Operation completed successfully",
      "user_id" => user_id,
      "resource_id" => created_id
  );
  
  // 3. ã‚¨ãƒ©ãƒ¼æ™‚ï¼ˆERRORï¼‰
  .map_err(|e| {
      log_with_context!(
          tracing::Level::ERROR,
          "Operation failed",
          "user_id" => user_id,
          "error" => &e.to_string()
      );
      e
  })?;
  ```

#### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š

* **main.rsã§ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¿½åŠ ï¼ˆé †åºé‡è¦ï¼‰**
  ```rust
  .layer(axum_middleware::from_fn(crate::logging::logging_middleware))
  .layer(axum_middleware::from_fn(crate::logging::inject_request_context))
  ```

* **RequestContextã®è‡ªå‹•ä»˜ä¸**
  - request_id: å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä¸€æ„ã®ID
  - user_id: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IDï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - path: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹
  - method: HTTPãƒ¡ã‚½ãƒƒãƒ‰

#### ãƒ­ã‚°å‡ºåŠ›ã®æ§‹é€ åŒ–

* **ã™ã¹ã¦ã®ãƒ­ã‚°ã¯æ§‹é€ åŒ–ã•ã‚Œã€ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚€**
  - message: ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - request_id: ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡ç”¨ID
  - ä»»æ„ã®key-valueãƒšã‚¢ï¼ˆuser_id, resource_idãªã©ï¼‰

* **HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ­ã‚°ã®è‡ªå‹•ãƒ¬ãƒ™ãƒ«èª¿æ•´**
  - 5xx: ERROR
  - 4xx: WARN
  - ãã®ä»–: INFO

#### æ—¢å­˜ã®tracingç›´æ¥ä½¿ç”¨ã®ç¦æ­¢

* **ä»¥ä¸‹ã®ç›´æ¥ä½¿ç”¨ã¯ç¦æ­¢ï¼ˆlog_with_context!ã‚’ä½¿ç”¨ï¼‰**
  - `tracing::debug!`
  - `tracing::info!`
  - `tracing::warn!`
  - `tracing::error!`

### 11. **UUID/IDæ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ±ä¸€å®Ÿè£…**

#### çµ±ä¸€UUID Extractorã®ä½¿ç”¨

* **ã™ã¹ã¦ã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®UUIDæ¤œè¨¼ã§ValidatedUuidã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::extractors::ValidatedUuid;
  
  // âœ… æ¨å¥¨
  pub async fn get_resource_handler(
      ValidatedUuid(resource_id): ValidatedUuid,
      State(state): State<AppState>,
  ) -> Result<ApiResponse<ResourceDto>> {
      // resource_idã¯æ¤œè¨¼æ¸ˆã¿ã®Uuid
  }
  
  // âŒ é¿ã‘ã‚‹ã¹ã
  pub async fn get_resource_handler(
      Path(resource_id): Path<Uuid>,
      State(state): State<AppState>,
  ) -> Result<ApiResponse<ResourceDto>> {
      // å€‹åˆ¥ã®UUIDæ¤œè¨¼ãŒå¿…è¦
  }
  ```

#### è¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†

* **è¤‡æ•°ã®UUIDãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒ‘ã‚¹ã«ã¯å°‚ç”¨ã®æ§‹é€ ä½“ã‚’å®šç¾©**
  ```rust
  use crate::extractors::deserialize_uuid;
  use serde::Deserialize;
  
  #[derive(Deserialize)]
  pub struct TeamMemberPath {
      #[serde(deserialize_with = "deserialize_uuid")]
      pub team_id: Uuid,
      #[serde(deserialize_with = "deserialize_uuid")]
      pub member_id: Uuid,
  }
  
  pub async fn update_member_handler(
      Path(params): Path<TeamMemberPath>,
      State(state): State<AppState>,
  ) -> Result<ApiResponse<MemberDto>> {
      // params.team_id, params.member_idã§æ¤œè¨¼æ¸ˆã¿ã®UUIDã«ã‚¢ã‚¯ã‚»ã‚¹
  }
  ```

#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‘½åè¦å‰‡

* **Axum 0.8ã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢å¼ `{param}` ã‚’ä½¿ç”¨**
* **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã¯å¯¾å¿œã™ã‚‹æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨å®Œå…¨ä¸€è‡´ã•ã›ã‚‹ã“ã¨**
  ```rust
  // âœ… æ­£ã—ã„ä¾‹
  .route("/teams/{team_id}/members/{member_id}", patch(update_member))
  // TeamMemberPathæ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ä¸€è‡´
  
  // âŒ é–“é•ã£ãŸä¾‹
  .route("/teams/{id}/members/{member}", patch(update_member))
  // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ä¸ä¸€è‡´
  ```

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ±ä¸€

* **ã™ã¹ã¦ã®UUIDæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã¯çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä½¿ç”¨**
  - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `"Invalid UUID format: 'xxx'"`
  - ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—: `AppError::BadRequest`
  - ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›

#### å®Ÿè£…ã®åˆ©ç‚¹

1. **æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€å…ƒåŒ–**: UUIDæ¤œè¨¼ãŒå˜ä¸€ã®å ´æ‰€ã«é›†ç´„
2. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€è²«æ€§**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§åŒã˜ã‚¨ãƒ©ãƒ¼å½¢å¼
3. **å‹å®‰å…¨æ€§ã®å‘ä¸Š**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«UUIDæ¤œè¨¼ã‚’ä¿è¨¼
4. **ä¿å®ˆæ€§ã®å‘ä¸Š**: æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´ãŒå®¹æ˜“
5. **ãƒ†ã‚¹ãƒˆã®ç°¡ç´ åŒ–**: Extractorè‡ªä½“ã®ãƒ†ã‚¹ãƒˆã§ç¶²ç¾…çš„ãªæ¤œè¨¼ãŒå¯èƒ½

### 12. **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±ä¸€å®Ÿè£…**

#### çµ±ä¸€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å‹ã®ä½¿ç”¨

* **ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã§shared/types/pagination.rsã®å‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::shared::types::{PaginatedResponse, PaginationMeta};
  use crate::types::query::PaginationQuery;
  ```

* **å®šæ•°ã®å®šç¾©ã¨ä½¿ç”¨**
  ```rust
  // shared/types/pagination.rs
  pub const DEFAULT_PAGE_SIZE: u32 = 20;
  pub const MAX_PAGE_SIZE: u32 = 100;
  ```

#### APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã®å®Ÿè£…

* **Query DTOã§PaginationQueryã‚’ä½¿ç”¨**
  ```rust
  // âœ… æ¨å¥¨: ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã—ã¦ä½¿ç”¨
  #[derive(Debug, Deserialize)]
  pub struct TaskSearchQuery {
      #[serde(flatten)]
      pub pagination: PaginationQuery,
      // ãã®ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶
  }
  
  // âœ… æ¨å¥¨: ç›´æ¥ä½¿ç”¨
  pub async fn get_resources_handler(
      Query(query): Query<PaginationQuery>,
      State(state): State<AppState>,
  ) -> Result<ApiResponse<PaginatedResponse<ResourceDto>>>
  
  // âŒ é¿ã‘ã‚‹ã¹ã: ç‹¬è‡ªå®Ÿè£…
  let page = params.get("page").and_then(|p| p.parse().ok()).unwrap_or(1);
  ```

#### ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã®å®Ÿè£…

* **get_pagination()ãƒ¡ã‚½ãƒƒãƒ‰ã§çµ±ä¸€çš„ã«å€¤ã‚’å–å¾—**
  ```rust
  let (page, per_page) = query.pagination.get_pagination();
  // pageã¯1ãƒ™ãƒ¼ã‚¹ã€per_pageã¯1ã€œ100ã®ç¯„å›²ã§è‡ªå‹•çš„ã«åˆ¶é™ã•ã‚Œã‚‹
  ```

* **PaginationMeta::new()ã§ãƒ¡ã‚¿æƒ…å ±ã‚’ç”Ÿæˆ**
  ```rust
  let pagination = PaginationMeta::new(page, per_page, total_count);
  let response = PaginatedResponse::new(items, page, per_page, total_count);
  ```

#### ãƒªãƒã‚¸ãƒˆãƒªå±¤ã§ã®å®Ÿè£…

* **ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºã®é‡è¤‡åˆ¶é™ã¯ä¸è¦**
  ```rust
  // âŒ é¿ã‘ã‚‹ã¹ã: get_pagination()ã§æ—¢ã«åˆ¶é™æ¸ˆã¿
  let page_size = std::cmp::min(page_size, 100);
  
  // âœ… æ¨å¥¨: ãã®ã¾ã¾ä½¿ç”¨
  let offset = (page - 1) * page_size;
  ```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã®çµ±ä¸€

* **å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®šç¾©**
  ```rust
  pub type TaskPaginationResponse = PaginatedResponse<TaskDto>;
  pub type UserListResponse = PaginatedResponse<UserSummary>;
  ```

#### å®Ÿè£…ã®åˆ©ç‚¹

1. **ä¸€è²«æ€§**: ã™ã¹ã¦ã®APIã§åŒã˜ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œ
2. **ä¿å®ˆæ€§**: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒä¸€ç®‡æ‰€ã«é›†ç´„
3. **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ ã‚’ä¿è¨¼
4. **DRYåŸå‰‡**: é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®æ’é™¤
5. **æ‹¡å¼µæ€§**: å°†æ¥çš„ãªå¤‰æ›´ãŒå®¹æ˜“

### 13. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€å®Ÿè£…**

#### çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ï¼ˆApiResponseï¼‰

* **ã™ã¹ã¦ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§`ApiResponse<T>`å‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::types::ApiResponse;
  
  #[derive(Serialize, Deserialize, Debug)]
  pub struct ApiResponse<T> {
      pub success: bool,
      pub data: Option<T>,
      #[serde(skip_serializing_if = "Option::is_none")]
      pub error: Option<ErrorDetail>,
      #[serde(skip_serializing_if = "Option::is_none")]
      pub meta: Option<ResponseMeta>,
  }
  ```

* **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä½œæˆãƒ‘ã‚¿ãƒ¼ãƒ³**
  ```rust
  // âœ… æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
  Ok(ApiResponse::success(response_data))
  
  // âœ… ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆAppErrorçµŒç”±ã§è‡ªå‹•å¤‰æ›ï¼‰
  Err(AppError::NotFound("Resource not found".to_string()))
  ```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

* **ResponseMetaã®æ§‹é€ **
  ```rust
  pub struct ResponseMeta {
      pub request_id: String,        // UUID v4
      pub timestamp: Timestamp,      // Unix timestampï¼ˆç§’ï¼‰
      pub pagination: Option<ResponsePaginationMeta>,
  }
  ```

* **æ—¥æ™‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã™ã¹ã¦Unix timestampå½¢å¼**
  - `Timestamp`å‹ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«Unix timestampï¼ˆç§’å˜ä½ï¼‰ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯ `new Date(timestamp * 1000)` ã§å¤‰æ›

#### ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æˆ»ã‚Šå€¤å‹

* **åŸºæœ¬çš„ãªæˆ»ã‚Šå€¤å‹**
  ```rust
  // âœ… æ¨™æº–çš„ãªã‚±ãƒ¼ã‚¹
  pub async fn get_resource_handler(
      // ...
  ) -> AppResult<ApiResponse<ResourceDto>> {
      Ok(ApiResponse::success(resource))
  }
  ```

* **ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»Cookieæ“ä½œãŒå¿…è¦ãªå ´åˆï¼‰**
  ```rust
  // âœ… èªè¨¼ç³»ãªã©ç‰¹æ®Šãªè¦ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿
  pub async fn signin_handler(
      // ...
  ) -> AppResult<impl IntoResponse> {
      let api_response = ApiResponse::success(auth_response);
      let mut response = api_response.into_response();
      // Cookieã‚„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
      add_cookies_to_response(&mut response, cookie_jar);
      Ok(response)
  }
  ```

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è‡ªå‹•å¤‰æ›

* **AppErrorã¯è‡ªå‹•çš„ã«ApiResponseå½¢å¼ã«å¤‰æ›ã•ã‚Œã‚‹**
  ```rust
  impl IntoResponse for AppError {
      fn into_response(self) -> Response {
          let status = match &self {
              AppError::NotFound(_) => StatusCode::NOT_FOUND,
              AppError::BadRequest(_) => StatusCode::BAD_REQUEST,
              // ...
          };
          let error_response = ApiResponse::<()>::error(self);
          (status, error_response).into_response()
      }
  }
  ```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

* **æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹**
  ```json
  {
    "success": true,
    "data": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Example",
      "created_at": 1736922123
    },
    "meta": {
      "request_id": "123e4567-e89b-12d3-a456-426614174000",
      "timestamp": 1736922123
    }
  }
  ```

* **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
  ```json
  {
    "success": false,
    "data": null,
    "error": {
      "code": "NOT_FOUND",
      "message": "Resource not found",
      "field": null
    },
    "meta": {
      "request_id": "123e4567-e89b-12d3-a456-426614174000",
      "timestamp": 1736922123
    }
  }
  ```

* **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
  ```json
  {
    "success": true,
    "data": {
      "items": [...],
      "pagination": {
        "current_page": 2,
        "page_size": 20,
        "total_pages": 5,
        "total_items": 95,
        "has_next": true,
        "has_prev": true
      }
    },
    "meta": {
      "request_id": "123e4567-e89b-12d3-a456-426614174000",
      "timestamp": 1736922123
    }
  }
  ```

#### å®Ÿè£…ã®åˆ©ç‚¹

1. **ä¸€è²«æ€§**: ã™ã¹ã¦ã®APIã§åŒã˜ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
2. **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®ç°¡ç´ åŒ–**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§çµ±ä¸€çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒå¯èƒ½
3. **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“ã•**: request_idã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡
4. **å‹å®‰å…¨æ€§**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ä¿è¨¼ã•ã‚Œã‚‹
5. **æ‹¡å¼µæ€§**: metaãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§è¿½åŠ æƒ…å ±ã‚’æŸ”è»Ÿã«æä¾›å¯èƒ½

### 14. **ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ±ä¸€å®Ÿè£…**

#### çµ±ä¸€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‹ã®ä½¿ç”¨

* **ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§çµ±ä¸€ã•ã‚ŒãŸã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**
  ```rust
  use crate::types::query::{PaginationQuery, SortQuery, SearchQuery};
  
  #[derive(Debug, Deserialize)]
  pub struct ResourceSearchQuery {
      #[serde(flatten)]
      pub pagination: PaginationQuery,
      #[serde(flatten)]
      pub sort: SortQuery,
      pub search: Option<String>,
      // ãƒªã‚½ãƒ¼ã‚¹å›ºæœ‰ã®ãƒ•ã‚£ãƒ«ã‚¿
  }
  ```

#### SearchQueryãƒˆãƒ¬ã‚¤ãƒˆã®å®Ÿè£…

* **ã™ã¹ã¦ã®æ¤œç´¢ã‚¯ã‚¨ãƒªDTOã§SearchQueryãƒˆãƒ¬ã‚¤ãƒˆã‚’å®Ÿè£…**
  ```rust
  impl SearchQuery for ResourceSearchQuery {
      fn search_term(&self) -> Option<&str> {
          self.search.as_deref()
      }
      
      fn filters(&self) -> HashMap<String, String> {
          let mut filters = HashMap::new();
          // ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ã‚’è¿½åŠ 
          filters
      }
  }
  ```

#### ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨

* **PaginationQueryå‹ã®ä½¿ç”¨**
  ```rust
  // âœ… æ¨å¥¨: çµ±ä¸€å‹ã‚’ä½¿ç”¨
  #[derive(Deserialize)]
  pub struct MyQuery {
      #[serde(flatten)]
      pub pagination: PaginationQuery,
  }
  
  // âŒ é¿ã‘ã‚‹ã¹ã: ç‹¬è‡ªå®Ÿè£…
  pub struct MyQuery {
      pub page: u64,
      pub per_page: u64,
  }
  ```

* **get_pagination()ãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨**
  ```rust
  let (page, per_page) = query.pagination.get_pagination();
  // pageã¯1ãƒ™ãƒ¼ã‚¹ã€per_pageã¯è‡ªå‹•çš„ã«1ã€œ100ã®ç¯„å›²ã«åˆ¶é™ã•ã‚Œã‚‹
  ```

#### ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…

* **SortQueryå‹ã®ä½¿ç”¨**
  ```rust
  // è¨±å¯ã•ã‚ŒãŸã‚½ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®šç¾©
  impl MySearchQuery {
      pub fn allowed_sort_fields() -> &'static [&'static str] {
          &["created_at", "updated_at", "name", "priority"]
      }
  }
  ```

#### æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ã®å‘½åè¦å‰‡

* **çµ±ä¸€ã•ã‚ŒãŸå‘½åè¦å‰‡ã‚’ä½¿ç”¨**
  ```rust
  // âœ… æ¨å¥¨: çµ±ä¸€ã•ã‚ŒãŸå‘½å
  pub created_after: Option<DateTime<Utc>>,
  pub created_before: Option<DateTime<Utc>>,
  
  // âŒ é¿ã‘ã‚‹ã¹ã: ä¸çµ±ä¸€ãªå‘½å
  pub from: Option<DateTime<Utc>>,
  pub to: Option<DateTime<Utc>>,
  pub start_date: Option<DateTime<Utc>>,
  pub end_date: Option<DateTime<Utc>>,
  ```

#### SeaORMã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

* **å‹å®‰å…¨ãªã‚¯ã‚¨ãƒªæ§‹ç¯‰ã«ã¯SeaORMã®æ©Ÿèƒ½ã‚’æ´»ç”¨**
  ```rust
  // å…±é€šãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
  fn apply_common_filters(
      &self,
      mut conditions: Condition,
      query: &TaskSearchQuery,
  ) -> Condition {
      // æ¤œç´¢æ¡ä»¶
      if let Some(search_term) = &query.search {
          conditions = conditions.add(
              Condition::any()
                  .add(task_model::Column::Title.contains(search_term))
                  .add(task_model::Column::Description.contains(search_term))
          );
      }
      // ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶
      if let Some(status) = &query.status {
          conditions = conditions.add(task_model::Column::Status.eq(status.as_str()));
      }
      conditions
  }
  
  // ã‚½ãƒ¼ãƒˆé©ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
  fn apply_sorting(
      &self,
      mut db_query: Select<TaskEntity>,
      query: &TaskSearchQuery,
  ) -> Select<TaskEntity> {
      if let Some(sort_by) = &query.sort.sort_by {
          // allowed_sort_fields()ã§è¨±å¯ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ã‚½ãƒ¼ãƒˆ
          if TaskSearchQuery::allowed_sort_fields().contains(&sort_by.as_str()) {
              // ã‚½ãƒ¼ãƒˆé©ç”¨
          }
      }
      db_query
  }
  ```

* **SeaORMã®åˆ©ç‚¹**
  - å‹å®‰å…¨æ€§: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º
  - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–æ¸ˆã¿
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æ©Ÿèƒ½
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
  - æ¥ç¶šãƒ—ãƒ¼ãƒ«ç®¡ç†

#### å®Ÿè£…ã®åˆ©ç‚¹

1. **ä¸€è²«æ€§**: ã™ã¹ã¦ã®APIã§åŒã˜ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‹•ä½œ
2. **ä¿å®ˆæ€§**: ã‚¯ã‚¨ãƒªãƒ­ã‚¸ãƒƒã‚¯ãŒä¸€ç®‡æ‰€ã«é›†ç´„
3. **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚¯ã‚¨ãƒªæ§‹é€ ã‚’ä¿è¨¼
4. **DRYåŸå‰‡**: é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®æ’é™¤
5. **æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒ•ã‚£ãƒ«ã‚¿ã‚„ã‚½ãƒ¼ãƒˆæ¡ä»¶ã®è¿½åŠ ãŒå®¹æ˜“
6. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: çµ±ä¸€ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆãŒç°¡æ½”ã«

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ä»¶

### å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testï¼‰

* **æ–°è¦ãƒ­ã‚¸ãƒƒã‚¯ã«å¯¾ã™ã‚‹ç´°ç²’åº¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…**

  * æ¡ä»¶åˆ†å²ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãªã©ã‚’ç¶²ç¾…
  * æ¦‚å¿µãƒ†ã‚¹ãƒˆãƒ»å‹ã ã‘ã®ãƒ†ã‚¹ãƒˆã¯ä¸å¯

### çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰

#### **åŸºæœ¬è¦ä»¶**

* APIãƒ¬ãƒ™ãƒ«ã§ã®**E2Eãƒ•ãƒ­ãƒ¼ç¢ºèª**
  * ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã®å¦¥å½“æ€§
  * DBæ›¸ãè¾¼ã¿ãƒ»èª­ã¿å‡ºã—ã®æ•´åˆæ€§
  * ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¤œè¨¼

#### **AAAï¼ˆArrange-Act-Assertï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹å®Ÿè£…**

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆã§ã¯ã€AAAãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ã€å„ãƒ†ã‚¹ãƒˆã‚’ä»¥ä¸‹ã®3ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã§æ§‹æˆã™ã‚‹ï¼š

```rust
#[tokio::test]
async fn test_example_feature() {
    // Arrangeï¼ˆæº–å‚™ï¼‰: ãƒ†ã‚¹ãƒˆã®å‰ææ¡ä»¶ã‚’è¨­å®š
    let (app, _schema, _db) = setup_full_app().await;
    let user = create_and_authenticate_user(&app).await;
    let initial_data = create_test_data();
    
    // Actï¼ˆå®Ÿè¡Œï¼‰: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®æ“ä½œã‚’å®Ÿè¡Œ
    let response = app.oneshot(
        create_request("POST", "/api/endpoint", &user.token, &initial_data)
    ).await.unwrap();
    
    // Assertï¼ˆæ¤œè¨¼ï¼‰: æœŸå¾…ã•ã‚Œã‚‹çµæœã‚’ç¢ºèª
    assert_eq!(response.status(), StatusCode::OK);
    verify_database_state(&db, &expected_state).await;
    verify_side_effects(&app).await;
}
```

#### **ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®å¿…é ˆè¦ç´ **

1. **Arrangeï¼ˆæº–å‚™ï¼‰ãƒ•ã‚§ãƒ¼ã‚º**
   - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆãƒ¢ãƒƒã‚¯ã‚„ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤ã‚’é¿ã‘ã‚‹ï¼‰
   - å¿…è¦ãªå‰ææ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™
   - ãƒ†ã‚¹ãƒˆç’°å¢ƒã®åˆæœŸçŠ¶æ…‹ã‚’æ˜ç¢ºã«å®šç¾©

2. **Actï¼ˆå®Ÿè¡Œï¼‰ãƒ•ã‚§ãƒ¼ã‚º**
   - å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’å†ç¾
   - 1ã¤ã®ãƒ†ã‚¹ãƒˆã«ã¤ã1ã¤ã®ä¸»è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®å®Ÿéš›ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œ

3. **Assertï¼ˆæ¤œè¨¼ï¼‰ãƒ•ã‚§ãƒ¼ã‚º**
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨æœ¬æ–‡ã‚’æ¤œè¨¼
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹å¤‰æ›´ã‚’ç¢ºèª
   - å‰¯ä½œç”¨ï¼ˆãƒ­ã‚°ã€é€šçŸ¥ã€é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ï¼‰ã‚’æ¤œè¨¼
   - ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã§ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚‚ç¢ºèª

#### **çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

1. **ç‹¬ç«‹æ€§ã®ç¢ºä¿**
   ```rust
   // å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ãŸã‚¹ã‚­ãƒ¼ãƒã§å®Ÿè¡Œã•ã‚Œã€ä»–ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã—ãªã„
   let (app, schema_name, db) = setup_full_app().await;
   // ãƒ†ã‚¹ãƒˆçµ‚äº†æ™‚ã«è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
   ```

2. **å®Ÿãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹æ¤œè¨¼**
   ```rust
   // âŒ é¿ã‘ã‚‹ã¹ãä¾‹
   assert_eq!(response["deleted_count"], 0); // å¸¸ã«0ã‚’æœŸå¾…
   
   // âœ… æ¨å¥¨ã•ã‚Œã‚‹ä¾‹
   // å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
   create_test_records(&db, 5).await;
   // å‰Šé™¤æ“ä½œã‚’å®Ÿè¡Œ
   let response = delete_old_records(&app).await;
   // å®Ÿéš›ã®å‰Šé™¤æ•°ã‚’æ¤œè¨¼
   assert_eq!(response["deleted_count"], 5);
   ```

3. **æ™‚é–“ä¾å­˜ãƒ†ã‚¹ãƒˆã®æ‰±ã„**
   ```rust
   // æ™‚é–“ã‚’æ“ä½œå¯èƒ½ã«ã™ã‚‹
   let old_data = create_data_with_timestamp(
       Utc::now() - Duration::days(91)
   ).await;
   let recent_data = create_data_with_timestamp(
       Utc::now() - Duration::days(30)
   ).await;
   
   // 90æ—¥ä»¥ä¸Šå¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã‚’ãƒ†ã‚¹ãƒˆ
   let result = cleanup_old_data(&app, 90).await;
   assert_eq!(result.deleted_count, 1);
   ```

4. **ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹ã®ç¶²ç¾…**
   ```rust
   // å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦æœ€ä½é™ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆ
   test_endpoint_success()           // æ­£å¸¸ç³»
   test_endpoint_validation_error()  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
   test_endpoint_unauthorized()      // èªè¨¼ã‚¨ãƒ©ãƒ¼
   test_endpoint_forbidden()         // èªå¯ã‚¨ãƒ©ãƒ¼
   test_endpoint_not_found()         // ãƒªã‚½ãƒ¼ã‚¹ä¸åœ¨
   ```

#### **ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å›é¿ç­–**

| ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ | å•é¡Œç‚¹ | æ”¹å–„ç­– |
|--------------|--------|--------|
| æ§‹é€ ã®ã¿ã®æ¤œè¨¼ | `assert!(response["data"].is_object())` | å®Ÿéš›ã®å€¤ã‚‚æ¤œè¨¼: `assert_eq!(response["data"]["count"], 10)` |
| å›ºå®šå€¤ã¸ã®ä¾å­˜ | ãƒ¢ãƒƒã‚¯ãŒå¸¸ã«åŒã˜å€¤ã‚’è¿”ã™ | å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦å‹•çš„ã«æ¤œè¨¼ |
| å‰¯ä½œç”¨ã®æœªæ¤œè¨¼ | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã¿ç¢ºèª | DBçŠ¶æ…‹ã€ãƒ­ã‚°ã€é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚‚ç¢ºèª |
| ãƒ†ã‚¹ãƒˆé–“ã®ä¾å­˜ | å®Ÿè¡Œé †åºã«ã‚ˆã‚ŠçµæœãŒå¤‰ã‚ã‚‹ | å„ãƒ†ã‚¹ãƒˆã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ |

#### **ãƒ†ã‚¹ãƒˆå®Œå…¨æ€§ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…æ™‚ã®ç¢ºèªäº‹é …ï¼š
- [ ] å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªã‚’å†ç¾ã—ã¦ã„ã‚‹ã‹
- [ ] ãƒ‡ãƒ¼ã‚¿ã¯å‹•çš„ã«ä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å€¤ã‚’é¿ã‘ã‚‹ï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å€¤ã¾ã§æ¤œè¨¼ã—ã¦ã„ã‚‹ã‹ï¼ˆæ§‹é€ ã ã‘ã§ãªãï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’ç¢ºèªã—ã¦ã„ã‚‹ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹ã‹ï¼ˆæœ€ä½5ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãŒç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½ã‹
- [ ] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã‚‹ã‹

#### **æ§‹é€ ã ã‘ã®ç©ºãƒ†ã‚¹ãƒˆã®å‰Šé™¤**

ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã®ã¿ã‚’æ¤œè¨¼ã—ã€å®Ÿéš›ã®å€¤ã‚’ç¢ºèªã—ãªã„ãƒ†ã‚¹ãƒˆã¯å‰Šé™¤ã™ã‚‹ã“ã¨ï¼š

```rust
// âŒ å‰Šé™¤å¯¾è±¡ã®ä¾‹
assert!(response["data"].is_object());
assert!(response["items"].is_array());
assert!(response["count"].is_number());

// âœ… ä»£ã‚ã‚Šã«å®Ÿéš›ã®å€¤ã‚’æ¤œè¨¼
assert_eq!(response["data"]["user_id"], user.id);
assert_eq!(response["items"].as_array().unwrap().len(), 5);
assert_eq!(response["count"], 10);
```

* **æ§‹é€ ã ã‘ã®ãƒ†ã‚¹ãƒˆã¯å®Ÿè£…ã®æ­£ã—ã•ã‚’ä¿è¨¼ã—ãªã„**
* **å¿…ãšå®Ÿéš›ã®å€¤ã¾ã§æ¤œè¨¼ã™ã‚‹ã“ã¨**
* **å‹•çš„ã«ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã¨çµæœã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨**

---

## ğŸ”¥ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ–¹é‡

* **ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰**ã®å–ã‚Šæ‰±ã„ï¼š
  1. **ãƒ†ã‚¹ãƒˆã§ã®ã¿ä½¿ç”¨** â†’ å®Ÿè£…ã§æ´»ç”¨ã™ã‚‹ã‚ˆã†çµ±åˆ
  2. **ã©ã“ã§ã‚‚æœªä½¿ç”¨** â†’ å‰Šé™¤
  3. **å°†æ¥ã®æ‹¡å¼µç”¨** â†’ å‰Šé™¤ï¼ˆYAGNIåŸå‰‡ï¼šYou Aren't Gonna Need Itï¼‰

* dead\_code ã§æ¤œçŸ¥ã•ã‚Œã‚‹è¦ç´ ã¸ã®å¯¾å¿œï¼š
  * **å…¬é–‹APIï¼ˆpubï¼‰** â†’ å®Ÿè£…ã§ã®æ´»ç”¨ã‚’æ¤œè¨
  * **å†…éƒ¨å®Ÿè£…ï¼ˆépubï¼‰** â†’ ä½¿ç”¨ã•ã‚Œã¦ã„ãªã‘ã‚Œã°å‰Šé™¤
  * **ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** â†’ ãã®ã¾ã¾ç¶­æŒ

* **é‡è¦**: ã€Œå°†æ¥ã®ãŸã‚ã«ã€ã¨ã„ã†ç†ç”±ã§ã‚³ãƒ¼ãƒ‰ã‚’æ®‹ã•ãªã„
  * å¿…è¦ã«ãªã£ãŸã¨ãã«å®Ÿè£…ã™ã‚‹
  * æœªä½¿ç”¨ã®ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã€æ§‹é€ ä½“ã€é–¢æ•°ã¯å‰Šé™¤
  * ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯å‰Šé™¤

---

## ğŸš€ å®Ÿè£…å®Œäº†å¾Œã®æœŸå¾…ã•ã‚Œã‚‹çŠ¶æ…‹

1. **`cargo clippy`ã§è­¦å‘Šã‚¼ãƒ­**ï¼ˆdead_codeè­¦å‘Šã‚’å«ã‚€ï¼‰
2. **`make ci-check-fast`ã§ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒã‚°ãƒªãƒ¼ãƒ³**
3. **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…ãŒä¸€è‡´**
4. **ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã®å®Ÿéš›ã®å‹•ä½œã‚’æ¤œè¨¼**
5. **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ãŒã‚¯ãƒªãƒ¼ãƒ³ã§ä¿å®ˆã—ã‚„ã™ã„**

---
